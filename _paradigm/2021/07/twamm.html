<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>TWAMM - Paradigm</title><meta name="description" content="Paradigm is a research-driven crypto investment firm that funds companies and protocols from their earliest stages."/><meta property="og:url" content="https://www.paradigm.xyz/2021/07/twamm"/><meta property="og:title" content="TWAMM"/><meta property="og:site_name" content="Paradigm"/><meta property="og:description" content="This paper introduces a new type of automated market maker, or AMM, that helps traders on Ethereum efficiently execute large orders -- The time-weighted average market maker, or TWAMM (pronounced &quot;tee-wham&quot;)."/><meta property="og:image" content="https://cdn.sanity.io/images/dgybcd83/production/0690a51019f0ec9694e9509c86e5b9303fa6f35e-2400x1350.png?auto=format&amp;q=75&amp;w=1200&amp;format=png"/><meta name="twitter:site" content="@paradigm"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="TWAMM - Paradigm"/><meta name="twitter:description" content="Paradigm is a research-driven crypto investment firm that funds companies and protocols from their earliest stages."/><meta name="twitter:url" content="https://www.paradigm.xyz/2021/07/twamm"/><meta name="twitter:image" content="https://cdn.sanity.io/images/dgybcd83/production/fd732ebeb1c4d286fd7e3b5b25395d72452edeb6-2400x1260.png?auto=format&amp;q=75&amp;w=1200&amp;format=png"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2021-07-28"/><meta property="article:modified_time" content="2021-07-28"/><meta property="article:author" content="https://paradigm-vc.vercel.app/team/dave-white"/><meta property="article:author" content="https://paradigm-vc.vercel.app/team/dan-mccarthy"/><meta property="article:author" content="https://twitter.com/haydenzadams"/><meta name="next-head-count" content="21"/><link rel="apple-touch-icon" sizes="180x180" href="../../favicon/apple-touch-icon.png"/><link rel="mask-icon" href="../../favicon/safari-pinned-tab.svg" color="#00d700"/><meta name="msapplication-TileColor" content="#00d700"/><link rel="icon" href="../../favicon/favicon.ico" sizes="any"/><link rel="icon" href="../../favicon/favicon.svg" type="image/svg+xml"/><link rel="manifest" href="../../favicon/site.webmanifest" crossorigin="use-credentials"/><meta name="theme-color" content="#00E100"/><link rel="preload" href="../../_next/static/css/36d742fa6f75af33.css" as="style"/><link rel="stylesheet" href="../../_next/static/css/36d742fa6f75af33.css" data-n-g=""/><link rel="preload" href="../../_next/static/css/5b6964bdff897f88.css" as="style"/><link rel="stylesheet" href="../../_next/static/css/5b6964bdff897f88.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="../../_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script defer="" src="../../_next/static/chunks/2334.fdd0fc2ee869ba74.js"></script><script defer="" src="../../_next/static/chunks/7333.de3f3254649aaade.js"></script><script src="../../_next/static/chunks/webpack-54ad8f2f0d9b23ef.js" defer=""></script><script src="../../_next/static/chunks/framework-cfbe8447b8b751ea.js" defer=""></script><script src="../../_next/static/chunks/main-9a281b117d523626.js" defer=""></script><script src="../../_next/static/chunks/pages/_app-64c08ce1425afd18.js" defer=""></script><script src="../../_next/static/chunks/175675d1-ea6ec12d1ec73e3b.js" defer=""></script><script src="../../_next/static/chunks/3114-9ad26c08e3a6fd59.js" defer=""></script><script src="../../_next/static/chunks/8294-352a030481cb472f.js" defer=""></script><script src="../../_next/static/chunks/1358-b6def54e6ad0bd04.js" defer=""></script><script src="../../_next/static/chunks/7213-de9885b5038b802a.js" defer=""></script><script src="../../_next/static/chunks/pages/[slug]/[postMonth]/[postSlug]-79dba873a1ad12ef.js" defer=""></script><script src="../../_next/static/l8SbaQQM0om_yyzCyQlj0/_buildManifest.js" defer=""></script><script src="../../_next/static/l8SbaQQM0om_yyzCyQlj0/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header><div class="lg:hidden fixed z-50 top-0 left-0 right-0 bg-white"><div class="px-container-mobile h-header-mobile flex justify-between items-center"><a class="block" href="../../index.html"><svg width="140" height="32" viewBox="0 0 140 32" class="block text-black"><path d="M28 9.84634L10.7692 0L8.61538 1.23168V3.69267L6.46154 2.46099L4.30769 3.69267V6.15367L2.15385 4.92198L0 6.15367V25.8463L2.15385 27.078L4.30769 25.8463V28.3073L6.46154 29.539L8.61538 28.3073V30.7683L10.7692 32L28 22.1537V19.6927L25.8462 18.461L28 17.2293V14.7683L25.8462 13.5366L28 12.305V9.84634ZM4.30769 23.3853L2.15385 24.617V7.38534L4.30769 8.61702V23.3853ZM10.7692 24.6147V22.1537L19.3846 17.2317L21.5385 18.4634L10.7692 24.6147ZM17.2308 16L10.7692 19.6927V12.3073L17.2308 16ZM19.3846 14.7683L10.7692 9.84634V7.38534L21.5385 13.539L19.3846 14.7683ZM6.46154 4.92198L8.61538 6.15367V8.61466L6.46154 7.38298V4.92198ZM6.46154 9.84634L8.61538 11.078V20.9244L6.46154 22.156V9.84634ZM6.46154 24.6147L8.61538 23.383V25.844L6.46154 27.0756V24.6147ZM25.8462 20.922L10.7692 29.5366V27.0756L23.6923 19.6903L25.8462 20.922ZM25.8462 16L23.6923 17.2317L21.5385 16L23.6923 14.7683L25.8462 16ZM23.6923 12.3073L10.7692 4.92198V2.46099L25.8462 11.0756L23.6923 12.3073Z" fill="#00E100"></path><g opacity="0"><path d="M38.9292 22.7264C38.9319 22.9865 39.6678 23.2626 40.7096 23.3938L41.4433 23.4572L41.4562 24.7103L33.9608 24.7879L33.9478 23.5348L34.5146 23.4581C35.5297 23.2821 36.118 23.0159 36.1154 22.7557L35.9733 9.04186C35.9706 8.78174 35.3768 8.52773 34.3584 8.37269L33.7903 8.30766L33.7773 7.05454L40.0195 6.98989C44.5119 6.94336 47.9329 8.46861 47.9691 11.968C48.0035 15.2783 45.0968 17.7441 40.3019 18.2666L40.005 16.9927C42.8857 16.5844 45.0725 15.4032 45.0474 12.9677C45.0201 10.3432 43.2509 8.46975 39.4441 8.50923L38.7822 8.51609L38.9294 22.7266L38.9292 22.7264Z" fill="currentColor"></path><path d="M48.7148 21.209C48.7148 18.5134 50.8902 17.9695 52.9475 17.6384C54.0353 17.4492 54.7445 17.1418 55.2884 16.5506L55.312 15.4156C55.3357 13.5713 54.5319 12.8382 53.3732 12.8382C52.309 12.8382 51.9307 13.3112 51.9307 13.9023C51.9307 14.3043 52.0253 14.6118 52.0253 14.8246C52.0253 15.132 51.5523 15.3685 50.6776 15.3685C49.9445 15.3685 49.2116 15.132 49.2116 14.8482C49.2116 13.7841 51.789 11.0885 54.3427 11.0885C56.5181 11.0885 57.866 11.9633 57.8187 14.5172L57.7004 19.9556C57.6531 22.0839 58.2443 22.6276 59.2848 22.6276C59.5449 22.6276 59.7104 22.604 59.9469 22.533L60.0179 22.5803C59.7341 23.739 58.8118 24.5192 57.677 24.5192C56.471 24.5192 55.7854 23.7625 55.407 22.6512C54.6976 23.8809 53.681 24.6376 52.2621 24.6376C50.3232 24.6376 48.7152 23.408 48.7152 21.209H48.7148ZM53.0656 22.8406C53.9169 22.8406 54.6263 22.3913 55.1938 21.8238L55.2648 17.8039C54.91 18.3005 54.3662 18.5607 53.5385 18.8208C52.2617 19.2228 51.1976 19.6011 51.1976 20.9961C51.1976 22.2021 51.9543 22.8406 53.0656 22.8406Z" fill="currentColor"></path><path d="M62.7621 14.5644C62.7621 14.328 62.5729 14.1388 60.9414 13.3821V12.531L64.2518 11.1121H64.843L65.2214 13.5476C66.1907 11.9632 67.042 11.1358 68.4609 11.1358C69.2176 11.1358 69.9031 11.4195 69.9031 11.7033C69.9031 12.862 69.1228 14.4225 68.7681 14.4225C68.6971 14.4225 68.6498 14.3989 68.4843 14.3043C67.9168 13.9732 67.3729 13.7604 66.8054 13.7604C66.3088 13.7604 65.7885 14.0442 65.3156 14.4698V22.2492C65.3156 22.5093 65.9304 22.7695 67.0891 22.935L67.8222 23.0296V24.1646H60.9885V23.0296L61.4142 22.935C62.431 22.7222 62.7619 22.5093 62.7619 22.2492V14.5642L62.7621 14.5644Z" fill="currentColor"></path><path d="M70.3496 21.209C70.3496 18.5134 72.525 17.9695 74.5823 17.6384C75.6701 17.4492 76.3793 17.1418 76.9232 16.5506L76.9468 15.4156C76.9705 13.5713 76.1666 12.8382 75.0079 12.8382C73.9438 12.8382 73.5654 13.3112 73.5654 13.9023C73.5654 14.3043 73.66 14.6118 73.66 14.8246C73.66 15.132 73.1871 15.3685 72.3123 15.3685C71.5793 15.3685 70.8464 15.132 70.8464 14.8482C70.8464 13.7841 73.4238 11.0885 75.9775 11.0885C78.1528 11.0885 79.5007 11.9633 79.4534 14.5172L79.3352 19.9556C79.2879 22.0839 79.8791 22.6276 80.9196 22.6276C81.1797 22.6276 81.3452 22.604 81.5817 22.533L81.6526 22.5803C81.3688 23.739 80.4466 24.5192 79.3117 24.5192C78.1057 24.5192 77.4201 23.7625 77.0418 22.6512C76.3324 23.8809 75.3157 24.6376 73.8969 24.6376C71.958 24.6376 70.35 23.408 70.35 21.209H70.3496ZM74.7003 22.8406C75.5516 22.8406 76.261 22.3913 76.8286 21.8238L76.8995 17.8039C76.5448 18.3005 76.0009 18.5607 75.1733 18.8208C73.8965 19.2228 72.8324 19.6011 72.8324 20.9961C72.8324 22.2021 73.5891 22.8406 74.7003 22.8406Z" fill="currentColor"></path><path d="M92.5238 24.8032H91.909L91.5779 22.9116C90.2065 23.8575 88.7404 24.6378 87.3691 24.6378C84.4132 24.6378 82.0723 22.1076 82.0723 18.3007C82.0723 13.9262 84.957 11.136 88.4566 11.136C89.6861 11.136 90.5847 11.3725 91.2941 11.8218V7.80802C91.2941 7.57155 91.0815 7.38237 89.4262 6.48397V5.65631L93.2568 4.35571H93.8244V19.9086C93.8244 21.9659 94.4156 22.5096 95.2903 22.5096C95.5031 22.5096 95.7158 22.4859 95.9524 22.4386L96.0234 22.4859V23.7629L92.5238 24.8032ZM88.953 22.6041C89.828 22.6041 90.5847 22.3913 91.2939 22.013V16.1488C91.2939 14.0444 89.9699 12.6729 88.1256 12.6729C86.2338 12.6729 84.744 14.0444 84.744 17.0238C84.744 20.618 86.3757 22.6041 88.953 22.6041Z" fill="currentColor"></path><path d="M96.944 24.1647V23.0296L97.3694 22.935C98.3863 22.6986 98.7171 22.4857 98.7171 22.2256V14.5643C98.7171 14.3278 98.5281 14.1386 96.8965 13.3819V12.5308L100.704 11.112H101.271V22.2256C101.271 22.4857 101.626 22.6986 102.619 22.935L103.044 23.0296V24.1647H96.9438H96.944ZM101.791 6.73762C101.791 7.84904 101.035 8.53462 99.9233 8.53462C98.8119 8.53462 98.0552 7.84885 98.0552 6.73762C98.0552 5.64984 98.8119 4.96426 99.9233 4.96426C101.058 4.96426 101.791 5.65003 101.791 6.73762Z" fill="currentColor"></path><path d="M108.193 19.8611C107.649 20.2867 107.223 20.7833 107.223 21.2799C107.223 21.7527 107.649 21.9657 108.997 22.0603L112.828 22.344C115.145 22.5332 116.469 23.6917 116.469 25.5599C116.469 28.3737 113.513 31.0222 109.21 31.0222C105.687 31.0222 103.984 29.7216 103.984 27.7591C103.984 26.5059 104.859 25.7019 106.94 24.1885C105.923 23.9757 104.576 23.2426 104.576 22.2969C104.576 21.3276 105.521 20.4526 107.129 19.6013C105.498 18.9865 104.363 17.6386 104.363 15.7707C104.363 12.9805 106.538 11.136 109.565 11.136C110.723 11.136 111.74 11.4907 112.497 12.0819L116.398 12.1765V13.4059L113.774 13.9971C114.057 14.4464 114.247 14.9665 114.247 15.6288C114.247 18.1352 112.095 19.9322 109.092 19.9322C108.784 19.9322 108.501 19.9085 108.193 19.8613L108.193 19.8611ZM109.943 29.5324C112.142 29.5324 113.939 28.2318 113.939 26.3875C113.939 25.2524 113.324 24.7559 111.432 24.614L108.311 24.4011C107.294 25.0869 106.419 26.0801 106.419 27.026C106.419 28.4446 107.696 29.5326 109.943 29.5326V29.5324ZM111.858 16.1723C111.858 14.3516 110.889 12.7436 109.044 12.7436C107.768 12.7436 106.869 13.6186 106.869 15.0372C106.869 16.8342 107.791 18.4659 109.659 18.4659C110.983 18.4659 111.858 17.5909 111.858 16.1723Z" fill="currentColor"></path><path d="M119.59 14.5654C119.59 14.3289 119.401 14.1397 117.77 13.383V12.5319L121.08 11.1131H121.671L121.955 12.9576C123.468 12.0117 125.076 11.1131 126.613 11.1131C127.984 11.1131 128.978 11.586 129.474 13.052C131.059 12.0826 132.737 11.1131 134.345 11.1131C136.355 11.1131 137.561 12.1772 137.561 16.0788V22.2504C137.561 22.5105 137.916 22.7233 138.932 22.9361L139.334 23.0307V24.1658H133.257V23.0307L133.659 22.9361C134.676 22.6997 135.007 22.5105 135.007 22.2504V16.4335C135.007 14.1872 134.132 13.2177 132.288 13.2177C131.389 13.2177 130.467 13.5014 129.71 13.9034C129.828 14.4946 129.876 15.2277 129.876 16.0788V22.2504C129.876 22.5105 130.207 22.7233 131.2 22.9361L131.625 23.0307V24.1658H125.572V23.0307L125.974 22.9361C126.991 22.6997 127.322 22.5105 127.322 22.2504V16.4335C127.322 14.1872 126.447 13.2177 124.579 13.2177C123.751 13.2177 122.876 13.4778 122.143 13.8325V22.2505C122.143 22.5107 122.474 22.6998 123.491 22.9363L123.893 23.0309V24.166H117.816V23.0309L118.242 22.9363C119.258 22.7235 119.589 22.5107 119.589 22.2505V14.5656L119.59 14.5654Z" fill="currentColor"></path></g></svg></a><button class="p-1 bg-black flex flex-col items-center text-center border border-solid border-transparent" aria-label="Mobile Menu"><div class="tag text-gray-dark"></div></button></div></div><div class="hidden lg:block fixed md:top-2 md:left-2 top-[16px] left-[16px] z-50 pointer-events-none w-full"><div class="grid grid-cols-12 items-center"><a class="col-start-1 block pointer-events-auto" href="../../index.html"><svg width="140" height="32" viewBox="0 0 140 32" class="block text-black"><path d="M28 9.84634L10.7692 0L8.61538 1.23168V3.69267L6.46154 2.46099L4.30769 3.69267V6.15367L2.15385 4.92198L0 6.15367V25.8463L2.15385 27.078L4.30769 25.8463V28.3073L6.46154 29.539L8.61538 28.3073V30.7683L10.7692 32L28 22.1537V19.6927L25.8462 18.461L28 17.2293V14.7683L25.8462 13.5366L28 12.305V9.84634ZM4.30769 23.3853L2.15385 24.617V7.38534L4.30769 8.61702V23.3853ZM10.7692 24.6147V22.1537L19.3846 17.2317L21.5385 18.4634L10.7692 24.6147ZM17.2308 16L10.7692 19.6927V12.3073L17.2308 16ZM19.3846 14.7683L10.7692 9.84634V7.38534L21.5385 13.539L19.3846 14.7683ZM6.46154 4.92198L8.61538 6.15367V8.61466L6.46154 7.38298V4.92198ZM6.46154 9.84634L8.61538 11.078V20.9244L6.46154 22.156V9.84634ZM6.46154 24.6147L8.61538 23.383V25.844L6.46154 27.0756V24.6147ZM25.8462 20.922L10.7692 29.5366V27.0756L23.6923 19.6903L25.8462 20.922ZM25.8462 16L23.6923 17.2317L21.5385 16L23.6923 14.7683L25.8462 16ZM23.6923 12.3073L10.7692 4.92198V2.46099L25.8462 11.0756L23.6923 12.3073Z" fill="#00E100"></path><g opacity="0"><path d="M38.9292 22.7264C38.9319 22.9865 39.6678 23.2626 40.7096 23.3938L41.4433 23.4572L41.4562 24.7103L33.9608 24.7879L33.9478 23.5348L34.5146 23.4581C35.5297 23.2821 36.118 23.0159 36.1154 22.7557L35.9733 9.04186C35.9706 8.78174 35.3768 8.52773 34.3584 8.37269L33.7903 8.30766L33.7773 7.05454L40.0195 6.98989C44.5119 6.94336 47.9329 8.46861 47.9691 11.968C48.0035 15.2783 45.0968 17.7441 40.3019 18.2666L40.005 16.9927C42.8857 16.5844 45.0725 15.4032 45.0474 12.9677C45.0201 10.3432 43.2509 8.46975 39.4441 8.50923L38.7822 8.51609L38.9294 22.7266L38.9292 22.7264Z" fill="currentColor"></path><path d="M48.7148 21.209C48.7148 18.5134 50.8902 17.9695 52.9475 17.6384C54.0353 17.4492 54.7445 17.1418 55.2884 16.5506L55.312 15.4156C55.3357 13.5713 54.5319 12.8382 53.3732 12.8382C52.309 12.8382 51.9307 13.3112 51.9307 13.9023C51.9307 14.3043 52.0253 14.6118 52.0253 14.8246C52.0253 15.132 51.5523 15.3685 50.6776 15.3685C49.9445 15.3685 49.2116 15.132 49.2116 14.8482C49.2116 13.7841 51.789 11.0885 54.3427 11.0885C56.5181 11.0885 57.866 11.9633 57.8187 14.5172L57.7004 19.9556C57.6531 22.0839 58.2443 22.6276 59.2848 22.6276C59.5449 22.6276 59.7104 22.604 59.9469 22.533L60.0179 22.5803C59.7341 23.739 58.8118 24.5192 57.677 24.5192C56.471 24.5192 55.7854 23.7625 55.407 22.6512C54.6976 23.8809 53.681 24.6376 52.2621 24.6376C50.3232 24.6376 48.7152 23.408 48.7152 21.209H48.7148ZM53.0656 22.8406C53.9169 22.8406 54.6263 22.3913 55.1938 21.8238L55.2648 17.8039C54.91 18.3005 54.3662 18.5607 53.5385 18.8208C52.2617 19.2228 51.1976 19.6011 51.1976 20.9961C51.1976 22.2021 51.9543 22.8406 53.0656 22.8406Z" fill="currentColor"></path><path d="M62.7621 14.5644C62.7621 14.328 62.5729 14.1388 60.9414 13.3821V12.531L64.2518 11.1121H64.843L65.2214 13.5476C66.1907 11.9632 67.042 11.1358 68.4609 11.1358C69.2176 11.1358 69.9031 11.4195 69.9031 11.7033C69.9031 12.862 69.1228 14.4225 68.7681 14.4225C68.6971 14.4225 68.6498 14.3989 68.4843 14.3043C67.9168 13.9732 67.3729 13.7604 66.8054 13.7604C66.3088 13.7604 65.7885 14.0442 65.3156 14.4698V22.2492C65.3156 22.5093 65.9304 22.7695 67.0891 22.935L67.8222 23.0296V24.1646H60.9885V23.0296L61.4142 22.935C62.431 22.7222 62.7619 22.5093 62.7619 22.2492V14.5642L62.7621 14.5644Z" fill="currentColor"></path><path d="M70.3496 21.209C70.3496 18.5134 72.525 17.9695 74.5823 17.6384C75.6701 17.4492 76.3793 17.1418 76.9232 16.5506L76.9468 15.4156C76.9705 13.5713 76.1666 12.8382 75.0079 12.8382C73.9438 12.8382 73.5654 13.3112 73.5654 13.9023C73.5654 14.3043 73.66 14.6118 73.66 14.8246C73.66 15.132 73.1871 15.3685 72.3123 15.3685C71.5793 15.3685 70.8464 15.132 70.8464 14.8482C70.8464 13.7841 73.4238 11.0885 75.9775 11.0885C78.1528 11.0885 79.5007 11.9633 79.4534 14.5172L79.3352 19.9556C79.2879 22.0839 79.8791 22.6276 80.9196 22.6276C81.1797 22.6276 81.3452 22.604 81.5817 22.533L81.6526 22.5803C81.3688 23.739 80.4466 24.5192 79.3117 24.5192C78.1057 24.5192 77.4201 23.7625 77.0418 22.6512C76.3324 23.8809 75.3157 24.6376 73.8969 24.6376C71.958 24.6376 70.35 23.408 70.35 21.209H70.3496ZM74.7003 22.8406C75.5516 22.8406 76.261 22.3913 76.8286 21.8238L76.8995 17.8039C76.5448 18.3005 76.0009 18.5607 75.1733 18.8208C73.8965 19.2228 72.8324 19.6011 72.8324 20.9961C72.8324 22.2021 73.5891 22.8406 74.7003 22.8406Z" fill="currentColor"></path><path d="M92.5238 24.8032H91.909L91.5779 22.9116C90.2065 23.8575 88.7404 24.6378 87.3691 24.6378C84.4132 24.6378 82.0723 22.1076 82.0723 18.3007C82.0723 13.9262 84.957 11.136 88.4566 11.136C89.6861 11.136 90.5847 11.3725 91.2941 11.8218V7.80802C91.2941 7.57155 91.0815 7.38237 89.4262 6.48397V5.65631L93.2568 4.35571H93.8244V19.9086C93.8244 21.9659 94.4156 22.5096 95.2903 22.5096C95.5031 22.5096 95.7158 22.4859 95.9524 22.4386L96.0234 22.4859V23.7629L92.5238 24.8032ZM88.953 22.6041C89.828 22.6041 90.5847 22.3913 91.2939 22.013V16.1488C91.2939 14.0444 89.9699 12.6729 88.1256 12.6729C86.2338 12.6729 84.744 14.0444 84.744 17.0238C84.744 20.618 86.3757 22.6041 88.953 22.6041Z" fill="currentColor"></path><path d="M96.944 24.1647V23.0296L97.3694 22.935C98.3863 22.6986 98.7171 22.4857 98.7171 22.2256V14.5643C98.7171 14.3278 98.5281 14.1386 96.8965 13.3819V12.5308L100.704 11.112H101.271V22.2256C101.271 22.4857 101.626 22.6986 102.619 22.935L103.044 23.0296V24.1647H96.9438H96.944ZM101.791 6.73762C101.791 7.84904 101.035 8.53462 99.9233 8.53462C98.8119 8.53462 98.0552 7.84885 98.0552 6.73762C98.0552 5.64984 98.8119 4.96426 99.9233 4.96426C101.058 4.96426 101.791 5.65003 101.791 6.73762Z" fill="currentColor"></path><path d="M108.193 19.8611C107.649 20.2867 107.223 20.7833 107.223 21.2799C107.223 21.7527 107.649 21.9657 108.997 22.0603L112.828 22.344C115.145 22.5332 116.469 23.6917 116.469 25.5599C116.469 28.3737 113.513 31.0222 109.21 31.0222C105.687 31.0222 103.984 29.7216 103.984 27.7591C103.984 26.5059 104.859 25.7019 106.94 24.1885C105.923 23.9757 104.576 23.2426 104.576 22.2969C104.576 21.3276 105.521 20.4526 107.129 19.6013C105.498 18.9865 104.363 17.6386 104.363 15.7707C104.363 12.9805 106.538 11.136 109.565 11.136C110.723 11.136 111.74 11.4907 112.497 12.0819L116.398 12.1765V13.4059L113.774 13.9971C114.057 14.4464 114.247 14.9665 114.247 15.6288C114.247 18.1352 112.095 19.9322 109.092 19.9322C108.784 19.9322 108.501 19.9085 108.193 19.8613L108.193 19.8611ZM109.943 29.5324C112.142 29.5324 113.939 28.2318 113.939 26.3875C113.939 25.2524 113.324 24.7559 111.432 24.614L108.311 24.4011C107.294 25.0869 106.419 26.0801 106.419 27.026C106.419 28.4446 107.696 29.5326 109.943 29.5326V29.5324ZM111.858 16.1723C111.858 14.3516 110.889 12.7436 109.044 12.7436C107.768 12.7436 106.869 13.6186 106.869 15.0372C106.869 16.8342 107.791 18.4659 109.659 18.4659C110.983 18.4659 111.858 17.5909 111.858 16.1723Z" fill="currentColor"></path><path d="M119.59 14.5654C119.59 14.3289 119.401 14.1397 117.77 13.383V12.5319L121.08 11.1131H121.671L121.955 12.9576C123.468 12.0117 125.076 11.1131 126.613 11.1131C127.984 11.1131 128.978 11.586 129.474 13.052C131.059 12.0826 132.737 11.1131 134.345 11.1131C136.355 11.1131 137.561 12.1772 137.561 16.0788V22.2504C137.561 22.5105 137.916 22.7233 138.932 22.9361L139.334 23.0307V24.1658H133.257V23.0307L133.659 22.9361C134.676 22.6997 135.007 22.5105 135.007 22.2504V16.4335C135.007 14.1872 134.132 13.2177 132.288 13.2177C131.389 13.2177 130.467 13.5014 129.71 13.9034C129.828 14.4946 129.876 15.2277 129.876 16.0788V22.2504C129.876 22.5105 130.207 22.7233 131.2 22.9361L131.625 23.0307V24.1658H125.572V23.0307L125.974 22.9361C126.991 22.6997 127.322 22.5105 127.322 22.2504V16.4335C127.322 14.1872 126.447 13.2177 124.579 13.2177C123.751 13.2177 122.876 13.4778 122.143 13.8325V22.2505C122.143 22.5107 122.474 22.6998 123.491 22.9363L123.893 23.0309V24.166H117.816V23.0309L118.242 22.9363C119.258 22.7235 119.589 22.5107 119.589 22.2505V14.5656L119.59 14.5654Z" fill="currentColor"></path></g></svg></a><div class="col-span-6 col-start-5 xl:col-span-5 xl:col-start-4"><div class="text-black pointer-events-auto bg-white px-2 w-fit -mx-3 border border-solid border-gray-neutral !border-transparent"><ul class="h-[48px] flex items-center justify-start gap-3 2xl:gap-4 font-mono text-mono-12"><li><a _key="426608038e76" class="flex gap-half items-center hover:underline" href="../../about.html">About</a></li><li><a _key="ff5f78089e91" class="flex gap-half items-center hover:underline" href="../../team.html">Team</a></li><li><a _key="38b3cd4525de" class="flex gap-half items-center hover:underline" href="../../portfolio.html">Portfolio</a></li><li><a _key="22b86a453ca1" class="flex gap-half items-center hover:underline" href="../../writing.html">Writing</a></li><li><a _key="cd5b2c9fbd5f" class="flex gap-half items-center hover:underline" href="../../oss.html">Open Source</a></li><li><a _key="05b4198b2e14" class="flex gap-half items-center hover:underline" href="../../careers.html">Careers</a></li></ul></div></div></div></div></header><div style="opacity:0"><div style="opacity:0"><div class="md:px-container-desktop pt-header-mobile md:pt-12 lg:pt-18"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-5 xl:col-start-4 px-container-mobile md:px-0 pt-6 md:pt-0 max-w-[900px]"><div class="flex flex-col gap-2"><div class="flex flex-col gap-2"><div class="flex flex-col gap-2"><div class="flex gap-1 md:gap-2 items-center font-mono text-mono-12 md:text-mono-13 text-gray-text"><span><a class="link-gray-black link-underline-hover" href="../../writing%3Ftags=research.html">Research</a></span></div><h1 class="font-mono text-mono-28 md:text-mono-40 tracking-tighter max-w-[1400px]">TWAMM</h1></div></div><p class="font-mono text-mono-12 gap-1 w-full justify-between"><span>07.28.2021</span><span class="px-1">|</span><span class="content-none after:content-[&#x27;,&#x27;] pr-1 before:content-[&#x27;By_&#x27;]"><a class="link-underline-hover" href="../../team/davewhite/index.html">Dave White</a></span><span class="content-none after:content-[&#x27;,&#x27;] pr-1"><a class="link-underline-hover" href="../../team/dan-mccarthy.html">Dan McCarthy</a></span><span class="content-none"><a _key="438948226a29" class="link-underline-hover" href="https://twitter.com/haydenzadams">Hayden Adams</a></span></p></div></div></div></div><div class="my-2 md:my-4 px-container-mobile md:px-container-desktop"><div class="relative"><div class="pointer-events-none lg:pointer-events-auto my-3"><div class="grid grid-cols-12 pointer-events-auto"><div class="col-span-12 md:col-start-2 xl:col-span-5 xl:col-start-4"><div class="flex flex-col gap-1"><p class="font-mono text-mono-12 uppercase font-medium">Outline</p><ul class="flex flex-col gap-1"><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#db1abe0ececc">1. Introduction</a></li><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#5b4dc46a1c39">2. Summary</a></li><li class="font-mono text-mono-12" style="margin-inline-start:0"><a class="link-underline-hover" href="twamm.html#155dedc076c1">3. Market Making Basics</a><ul class="flex flex-col mt-1 gap-1 ml-[25px]"><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#4df658761a99">1. Market Makers</a></li><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#cf025149d42d">2. Adverse Selection</a></li></ul></li><li class="font-mono text-mono-12" style="margin-inline-start:0"><a class="link-underline-hover" href="twamm.html#c985b642107d">4. Automated Market Makers</a><ul class="flex flex-col mt-1 gap-1 ml-[25px]"><li class="font-mono text-mono-12" style="margin-inline-start:0"><a class="link-underline-hover" href="twamm.html#ed26477b844e">1. The Constant Product Formula</a><ul class="flex flex-col mt-1 gap-1 ml-[25px]"><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#056262807c9d">1. Example</a></li><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#325d4826eb7d">2. Price Impact and Adverse Selection</a></li></ul></li></ul></li><li class="font-mono text-mono-12" style="margin-inline-start:0"><a class="link-underline-hover" href="twamm.html#223ac5c918c1">5. Executing Large Orders on Current AMMs</a><ul class="flex flex-col mt-1 gap-1 ml-[25px]"><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#0fdeda0f4fc8">1. Manual Order Splitting</a></li><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#42c2c20c08c8">2. The Sub-Order Size Tradeoff</a></li></ul></li><li class="font-mono text-mono-12" style="margin-inline-start:0"><a class="link-underline-hover" href="twamm.html#ccd443f1c3b6">6. Analogy to Traditional Finance</a><ul class="flex flex-col mt-1 gap-1 ml-[25px]"><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#e5b315d67154">1. The TWAP Order</a></li></ul></li><li class="font-mono text-mono-12" style="margin-inline-start:0"><a class="link-underline-hover" href="twamm.html#085819af467d">7. The Time-Weighted Average Market Maker</a><ul class="flex flex-col mt-1 gap-1 ml-[25px]"><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#c056b6512492">1. Overview</a></li><li class="font-mono text-mono-12" style="margin-inline-start:0"><a class="link-underline-hover" href="twamm.html#78164e405651">2. Ethereum Refresher</a><ul class="flex flex-col mt-1 gap-1 ml-[25px]"><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#1c9cb6292216">1. Blocks</a></li><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#421d0c3143fe">2. Miners</a></li><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#2afb7c9e22c4">3. Gas</a></li></ul></li><li class="font-mono text-mono-12" style="margin-inline-start:0"><a class="link-underline-hover" href="twamm.html#1d359704c8d6">3. Basic Design</a><ul class="flex flex-col mt-1 gap-1 ml-[25px]"><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#4e10484d320f">1. Long-Term Orders</a></li><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#e72d266da5a3">2. Order Pools</a></li><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#9d85ca84f945">3. Virtual Orders</a></li><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#b8a7975a6f3b">4. Arbitrage</a></li><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#c5a3db008f98">5. Order Expiry</a></li><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#006bfbb586e6">6. Economics</a></li></ul></li><li class="font-mono text-mono-12" style="margin-inline-start:0"><a class="link-underline-hover" href="twamm.html#a2cf99104ee3">4. Infinitesimal Virtual Orders</a><ul class="flex flex-col mt-1 gap-1 ml-[25px]"><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#8afa5f4e251d">1. Smoothness</a></li><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#d759e0ce27fc">2. Efficiency</a></li><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#77fded8412a4">3. Efficiency</a></li></ul></li></ul></li><li class="font-mono text-mono-12" style="margin-inline-start:0"><a class="link-underline-hover" href="twamm.html#90ef77622392">8. Implementation</a><ul class="flex flex-col mt-1 gap-1 ml-[25px]"><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#a8ac9bed855f">1. Lazy Evaluation</a></li><li class="font-mono text-mono-12" style="margin-inline-start:0"><a class="link-underline-hover" href="twamm.html#2023a54839f9">2. Gas Optimizations</a><ul class="flex flex-col mt-1 gap-1 ml-[25px]"><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#d9bd650d8b4d">1. Pooling Orders</a></li><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#29cba9d7d204">2. Long-Term Order Expiration</a></li><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#74b91b5b2645">3. Canceling Long-Term Orders</a></li></ul></li><li class="font-mono text-mono-12" style="margin-inline-start:0"><a class="link-underline-hover" href="twamm.html#293d2d21de9b">3. Virtual Trade Math</a><ul class="flex flex-col mt-1 gap-1 ml-[25px]"><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#b076f46f4d0f">1. Definitions</a></li><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#e1038e4b2294">2. Formulas</a></li></ul></li></ul></li><li class="font-mono text-mono-12" style="margin-inline-start:0"><a class="link-underline-hover" href="twamm.html#96cbae52ba61">9. Potential Attack Vectors</a><ul class="flex flex-col mt-1 gap-1 ml-[25px]"><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#07bfda9e3852">1. Sandwich Attacks</a></li><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#7606f8d155e5">2. Description</a></li><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#5d968a801c92">3. Sandwiching and Virtual Orders</a></li><li class="font-mono text-mono-12" style="margin-inline-start:0"><a class="link-underline-hover" href="twamm.html#ecd6b3ba7bdc">4. Information Leakage</a><ul class="flex flex-col mt-1 gap-1 ml-[25px]"><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#7e0a6183220b">1. Example</a></li></ul></li></ul></li><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#e9a4b8c5ef35">10. Python Reference Implementation</a></li><li class="font-mono text-mono-12"><a class="link-underline-hover" href="twamm.html#d270dc215f3a">11. Conclusion</a></li></ul></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h2 id="db1abe0ececc">Introduction</h2><p>This paper introduces a new type of automated market maker, or AMM, that helps traders on Ethereum efficiently execute large orders.</p><p>We call it the <em>time-weighted average market maker</em>, or TWAMM (pronounced &quot;tee-wham&quot;).</p><p>It works by breaking long-term orders into infinitely many infinitely small pieces and executing them against an embedded constant-product AMM smoothly over time.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h2 id="5b4dc46a1c39">Summary</h2><p>Let&#x27;s say Alice wants to buy 100 million USDC worth of ETH on-chain. An order of this size will be expensive to execute on existing AMMs like Uniswap, which must charge Alice a high price in case she knows something they don&#x27;t.</p><p>Today, Alice&#x27;s best option is to manually break her order up into several pieces and execute them over a period of hours, giving the market time to realize she does not have inside information so it can give her a better price.</p><p>If she sends a few large sub-orders, each will still have significant price impact and will be vulnerable to <em>sandwich attacks</em> by adversarial traders. On the other hand, if she sends many small sub-orders, she will have to take on all the work and risk of active trading, and will pay high costs in the form of per-transaction gas fees to miners.</p><p>The TWAMM resolves this dilemma for Alice by trading on her behalf. It breaks her order into infinitely many infinitely small <em>virtual orders</em> to ensure perfectly smooth execution over time, and, using a special mathematical relationship with its embedded AMM, is able to amortize gas costs across these virtual orders. Because it processes trades <em>in between</em> blocks, it is also less susceptible to sandwich attacks.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><h2 id="155dedc076c1">Market Making Basics</h2></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h3 id="4df658761a99">Market Makers</h3><p>Consider a market for two financial assets, say, USDC and ETH. A <em>market maker</em> is a participant in this market who is willing, at any time, to trade either one for the other.</p><p>If you have 100 million USDC and want to use it to buy ETH, you probably won&#x27;t be able to find another individual who wants to do the opposite trade at the exact same time. Instead, you will most likely go to a market populated by one or more market makers and trade with them.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h3 id="cf025149d42d">Adverse Selection</h3><p>Market makers earn a profit from the <em>spread</em>, effectively a fee they charge on each trade. They lose money when prices <em>move against</em> them — when they buy an asset whose price then goes down, or sell an asset whose price then goes up.</p><p>Unfortunately for market makers, prices tend to move against them on average. This phenomenon is known as <em>adverse selection.</em> It happens because traders with information about future price movements are more likely to trade against market makers for large size.</p><p>The most dangerous orders are ones that are both <em>large</em> and <em>urgent</em>, because those are precisely the type of orders informed traders tend to make. As a result, the most basic market making tactic is to <em>fade</em> incoming orders, adjusting prices up when a large buy order comes in, and adjusting prices down when a large sell order comes in.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h2 id="c985b642107d">Automated Market Makers</h2><p>In the past year, <em>automated market makers (AMMs)</em>, led by <a class="" href="https://info.uniswap.org/#/">Uniswap</a>, have become hugely popular on Ethereum, handling billions of dollars of volume daily. True to their name, AMMs automate much of the market making process.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h3 id="ed26477b844e">The Constant Product Formula</h3><p>The <em>constant product formula</em> is a simple rule that allows anybody to spin up both a new market and a new AMM for a new pair of assets instantaneously.</p><p>To create a new Constant Product AMM (CPAMM) between two assets X and Y, a user, called a <em>liquidity provider</em>, or LP, deposits <em>reserves</em> x and y of those two assets.</p><p>The ratio of these assets at any given time represents the <em>instantaneous price</em> on the AMM, or the price it will charge for a very small order. For example, if a CPAMM contains 2,000 USDC and 1 ETH in its reserves, its instantaneous price for ETH will be 2,000 USDC.</p><p>When traders come to trade with the AMM, it decides what price to give them based on the formula **x * y = k, where x and y are the reserve sizes and k is a constant. This means that the <em>product</em> of its reserve sizes stays the same during a trade (ignoring fees).</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h4 id="056262807c9d">Example</h4><p>Consider an ETH/USDC CPAMM with 2,000 USDC and 1 ETH in the reserves, so that x = 2,000, y = 1, and x * y = k = 2,000. The instantaneous price of this AMM is 2,000 / 1 = 2,000 USDC per ETH.</p><p>If a trader comes and buys 2,000 USDC worth of ETH, that means they are depositing 2,000 USDC into the X reserves, so that we will have x = 2,000 + 2,000 = 4,000.</p><p>Then, since k = 2000, we must have y = k/x = 2000/4000 = 0.5 after the trade. Since y was originally 1, 1 - 0.5 = 0.5 ETH must have gone to the trader.</p><p>Since the trader bought 0.5 ETH with their 2000 USDC, they paid an average price of 4,000 USDC per ETH. This high price relative to the instantaneous price reflects the large order size relative to the liquidity in the AMM.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h4 id="325d4826eb7d">Price Impact and Adverse Selection</h4><p>In the above case, the trader had to pay 4,000 USDC per ETH for their large order when the cost for a small order would have been only 2,000 USDC per ETH. This difference in price is referred to as the <em>price impact</em> of the order. The larger the incoming order, the greater the price impact.</p><p>This is how the AMM combats adverse selection: large incoming orders are more likely to be informed, and so the AMM makes them pay a high price. It is the automated equivalent of fading an order.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><h2 id="223ac5c918c1">Executing Large Orders on Current AMMs</h2></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h3 id="0fdeda0f4fc8">Manual Order Splitting</h3><p>As we can see, executing a large order on an AMM in a single transaction is expensive by design. <a class="" href="../04/understanding-automated-market-makers-part-1-price-impact/index.html">This excellent article</a> goes into the problem in depth and recommends some solutions.</p><p>In short, a trader who wishes to execute a large order on an AMM should not do it in a single transaction: they are better off splitting their order into several pieces. This could involve sending orders to several AMMs at once, but these AMMs too will have limited liquidity at any given point in time. The larger the order, the more attractive splitting it up over <em>time</em> becomes.</p><p>For example, let&#x27;s say an investor wants to buy 100 million USDC of ETH on-chain. They don&#x27;t have any short-term information about the price of ETH, and so don&#x27;t mind if their order takes some time to execute. In this case, they might break their order into ten chunks of ten million USDC each and execute each chunk one hour apart, limiting the price impact of each part.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h3 id="42c2c20c08c8">The Sub-Order Size Tradeoff</h3><p>Obviously, if a very large order is split into only a few pieces, each individual sub-order will still be large, and will incur price impact accordingly. Splitting the order into even smaller pieces helps, but this introduces two new problems of its own.</p><p>The first problem is <em>operational complexity</em>, meaning increased risk and work. The trader might enter the wrong trade quantity for a given trade, or the wrong direction. Or her computer could crash, preventing her from executing part of the order. Even if everything goes right, the process takes time and effort, distracting attention from more profitable endeavors.</p><p>The second problem is that each trade incurs fixed <em>transaction costs</em>, such as the <em>gas</em> paid to Ethereum miners to process the transaction. If the trader splits her order into too many pieces, she can end up spending more money on fees than on actually buying ETH.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h2 id="ccd443f1c3b6">Analogy to Traditional Finance</h2><p>In the world of traditional finance, if an investor or institution wanted to buy $100 million dollars of Apple stock, they would not send a $100 million market buy order directly to an exchange. Nor would they send ten such orders for $10 million each. Breaking the order into pieces much smaller than that would be impractical for most without dedicated trading staff and infrastructure.</p><p>Instead, they would most likely send their large order to a broker, who would put on an <a class="" href="https://en.wikipedia.org/wiki/Algorithmic_trading"><em>algorithmic trade</em></a> for them in exchange for a fee. The broker would execute the trade over a specified period of time, say, eight hours, at a price similar to some benchmark. The broker would have a team specialized in executing such trades safely and cheaply.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h3 id="e5b315d67154">The TWAP Order</h3><p>Perhaps the most basic type of algorithmic trade is the <a class="" href="https://en.wikipedia.org/wiki/Time-weighted_average_price">Time-Weighted Average Price</a>, or TWAP (pronounced &quot;tee-whap&quot;) order. A TWAP order to buy $100 million dollars of Apple stock over eight hours would, as the name suggests, get filled at a price close to the time-weighted average price of Apple stock over that period.</p><p>For example, if Apple stock spent four hours priced at $100 and four hours priced at $120 over the time period, the time-weighted average price would be ($100 * 4 + $120 * 4)/8 = $110, and the broker would execute the TWAP order for near that price.</p><p>Details vary, but the broker would most likely execute this trade by splitting it into many small pieces throughout the day and sending them to the market. Buying $100 million of Apple stock over eight hours is equivalent to buying around $350 of Apple stock every 100 milliseconds, and we might expect the broker to do more or less that.</p><p>The broker has the infrastructure to reduce or eliminate the operational complexity of so many small trades, and, as they have a direct connection to the market, will likely not have to pay much in transaction costs.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h2 id="085819af467d">The Time-Weighted Average Market Maker</h2><p>The Time-Weighted Average Market Maker (TWAMM) provides the on-chain equivalent of the TWAP order. The TWAMM has specialized logic for order splitting and a direct connection to an embedded exchange, providing smooth execution for low gas cost. Arbitrageurs keep prices on the TWAMM&#x27;s embedded exchange in line with market prices, ensuring execution near the time-weighted average price of the asset.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h3 id="c056b6512492">Overview</h3><p>Each TWAMM instance facilitates trading between a particular pair of assets, such as ETH and USDC.</p><p>The TWAMM contains an <em>embedded AMM</em>, a standard constant-product market maker for those two assets. Anyone may trade with this embedded AMM at any time, just as if it were a normal AMM.</p><p>Traders can submit <em>long-term orders</em> to the TWAMM, which are orders to sell a fixed amount of one of the assets over a fixed number of blocks — say, an order to sell 100 ETH over the next 2,000 blocks.</p><p>The TWAMM breaks these long-term orders into infinitely many infinitely small <em>virtual sub-orders</em>, which trade against the embedded AMM at an even rate over time. Processing transactions for each of these virtual sub-orders individually would cost infinite gas, but a closed-form mathematical formula allows us to calculate their cumulative effect only when needed.</p><p>The execution of long-term orders will push the embedded AMM&#x27;s price away from prices on other markets over time. When this happens, <em>arbitrageurs</em> will trade against the embedded AMM&#x27;s price to bring it back in line, ensuring good execution for long-term orders.</p><p>For example, if long-term sells have made ETH cheaper on the embedded AMM than it is on a particular centralized exchange, arbitrageurs will buy ETH from the embedded AMM, bringing its price back up, and sell it on the centralized exchange for a profit.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><h3 id="78164e405651">Ethereum Refresher</h3></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h4 id="1c9cb6292216">Blocks</h4><p>Ethereum bundles transactions into sequential groups called <em>blocks</em>, approximately one every 13 seconds. For the purposes of this post, we will number each block: block 1 is followed by block 2, which is followed by block 3, and so on.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h4 id="421d0c3143fe">Miners</h4><p>A distributed groups of <em>miners</em> competes to process each block. Anybody with an internet connection can become a miner. This means that programs like AMMs that run on Ethereum cannot keep any secrets: everybody has to be able to calculate exactly what they will do given their inputs.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h4 id="2afb7c9e22c4">Gas</h4><p>Computation on Ethereum is a scarce resource, and so users must pay miners for it in the form of <em>gas</em>. The more computation involved in a given transaction, the more gas it will consume. This gas cost is paid entirely by the person submitting the transaction.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><h3 id="1d359704c8d6">Basic Design</h3></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h4 id="4e10484d320f">Long-Term Orders</h4><p>Alice wants to buy 100 million USDC worth of ETH over the next 8 hours, or about 2,000 blocks. She enters a long-term order into the TWAMM to buy 100 million USDC worth of ETH over 2,000 blocks, or 50,000 USDC per block.</p><p>As mentioned above, we don&#x27;t know in advance which miners will process future transactions on the TWAMM. This means Alice&#x27;s order must be visible to everyone, introducing information leakage concerns which we discuss below.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h4 id="e72d266da5a3">Order Pools</h4><p>Bob wants to sell 500 ETH for USDC over the next 5,000 blocks, or 0.1 ETH per block.</p><p>Charlie wants to sell 100 ETH for USDC over the next 2,000 blocks, or 0.05 ETH per block.</p><p>Until Charlie&#x27;s order expires in 2,000 blocks, Bob&#x27;s and Charlie&#x27;s orders will be grouped together in a <em>pool</em>.</p><p>This ETH selling pool will sell ETH at a rate of 0.15 ETH per block for the next 2,000 blocks. Bob will get 0.1/0.15 ≈ 66% of the USDC the pool earns in this way. Charlie will get 0.05/0.15 ≈ 33% of the USDC the pool earns.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h4 id="9d85ca84f945">Virtual Orders</h4><p>Every block for the next 2,000 blocks, the TWAMM has to buy 50,000 USDC worth of ETH on behalf of Alice and sell 0.15 ETH for USDC on behalf of the ETH selling pool.</p><p>We can imagine that the TWAMM splits each of these two sub-orders into trillions of tiny sub-sub-orders we call <em>virtual orders</em> (in fact, it breaks them into an infinite number of infinitesimal virtual orders).</p><p>The TWAMM then takes turns executing these virtual orders against its embedded AMM: first one of Alice&#x27;s virtual orders, then one of the ETH selling pool&#x27;s, then another of Alice&#x27;s, and so on.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h4 id="b8a7975a6f3b">Arbitrage</h4><p>Because Alice is buying much more ETH than the ETH pool is selling, the price of ETH on the embedded AMM will go up each block.</p><p>When this price is sufficiently high relative to the prices for ETH elsewhere, <em>arbitrageurs</em> will buy that cheaper ETH on other exchanges and sell it on the embedded AMM, bringing its prices back in line with the market average and ensuring good execution for Alice.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h4 id="c5a3db008f98">Order Expiry</h4><p>After block 2,000, Alice&#x27;s order will be completely filled, as will Charlie&#x27;s. Bob&#x27;s order to sell ETH is still in effect for the next 3,000 blocks, and the TWAMM will continue to execute it at a rate of 0.1 ETH per block during that period.</p><p>Barring any outside activity, this will push the price of ETH down on the embedded AMM over time, this time prompting arbitrageurs to bring prices back <em>up</em> once they get sufficiently out of line.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h4 id="006bfbb586e6">Economics</h4><p>Because none of Alice, Bob, or Charlie are in a hurry to execute their orders, other market participants can infer that their orders represent less adverse selection than they otherwise would, and can provide them with low-price-impact execution.</p><p>Because the TWAMM will then be the best place for people like Alice, Bob, and Charlie to trade, LPs on the TWAMM&#x27;s embedded AMM are likely to interact with a high volume of uninformed flow like theirs. This helps LPs earn money from fees while reducing their relative exposure to adverse selection.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h3 id="a2cf99104ee3">Infinitesimal Virtual Orders</h3><p>We mentioned above that the TWAMM splits long-term orders into infinitely many infinitely small sub-orders. There are two reasons to do this: smoothness and efficiency.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h4 id="8afa5f4e251d">Smoothness</h4><p>The primary goal of the TWAMM is to execute its long-term orders smoothly over time so that they are executed for close to the prevailing time-weighted average price.</p><p>As we decrease the size of the virtual trades, price movement on the AMM becomes less and less jagged.</p><p>In the limit, with infinitely many infinitely small trades, price movement is perfectly smooth as virtual trades are executed.</p><p></p><figure class="py-1 gap-2 flex flex-col"><div class="image overflow-hidden" style="height:0;padding-bottom:75.09765625%"><picture><img class="scale-105 blur-lg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAABX0lEQVQokY2TiY7jMAxD8/8/ugWaZqZ1bYnU0YXsOTHHLpEEiKOXULSyqWprbd/3P1P7vj+/6mnqOI7L5XIcx1psramqkmPItuDLvp9Op/P53HsHwM/6uGJm5qF0Ed0AiEjvvbXWeyeZvyoyzRPmChRM0t1jKjMfPyvzYZH0MHcA23LyO/OmeCHD3aDT9n/C03CRER7Ogu/3++rzW5uPjLrO0yJo4e7pDPsnHJ6OKg03MyVBOMUpRlWVTUS+sZ2ZbkFxDNdODBERHcAwdIOwPixfAsusloyOYdqteIEOVSE1TNMR5d0B/QgXF04jDOUtpuGqq5ry/whbKUTE61aRWe2ZG5xwQxgy6o2RL3uTEYUVufZswjVupFMNFUPxddDLfdILji9xvsNQhQzqqCRUUfcUcCiGUlF9rfl7G0QzE5Fttl71BGaEC0Yf43q9PV9v19ttjLH+Cq0nNc6q2nv/Cz0pcPxP5ikrAAAAAElFTkSuQmCC"/></picture></div></figure><p><em>See: https://github.com/para-dave/twamm/blob/master/splitting_exploration.ipynb</em></p><p></p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h4 id="d759e0ce27fc">Efficiency</h4><p>Because the TWAMM is designed to be used on Ethereum, explicitly calculating transactions for multiple virtual trades per block would be prohibitively expensive. However, when we have infinitely many infinitesimal trades, we can compute the outcome for traders in a single computation, no matter how many blocks it has been since we last checked.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h4 id="77fded8412a4">Efficiency</h4><p>Because the TWAMM is designed to be used on Ethereum, explicitly calculating transactions for multiple virtual trades per block would be prohibitively expensive. However, when we have infinitely many infinitesimal trades, we can compute the outcome for traders in a single computation, no matter how many blocks it has been since we last checked.</p><p><br/></p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><h2 id="90ef77622392">Implementation</h2></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h3 id="a8ac9bed855f">Lazy Evaluation</h3><p>The TWAMM treats virtual sub-orders as if they take place in the space <em>between</em> blocks, which is important to avoid sandwich attacks.</p><p>To achieve this in a gas-efficient manner, the TWAMM uses <em>lazy evaluation</em>, computing the effect of virtual trades only when it is necessary to determine the outcome of an interaction.</p><p>Every time a user interacts with the TWAMM (for example, by trading with the embedded AMM or by adding a new long-term order), the TWAMM retroactively calculates the effect of all the virtual trades that took place since the last interaction.</p><p>Because these virtual trades are interacting only with the TWAMM&#x27;s embedded AMM, the behavior of the TWAMM is completely deterministic between external interactions. Even if the TWAMM goes one million blocks between external interactions, the next time somebody interacts with it, it will be able to accurately calculate the results of all of the intervening virtual trades.</p><p>Front-ends plugged into the TWAMM will be able to account for virtual trades that have not yet been represented on-chain by keeping track of the current block number and doing the TWAMM calculation themselves.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><h3 id="2023a54839f9">Gas Optimizations</h3></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h4 id="d9bd650d8b4d">Pooling Orders</h4><p>As demonstrated in the example, when we have multiple long-term orders in the same direction (i.e. selling ETH for USDC), we pool them together before splitting them into virtual orders. The TWAMM can then track balances using a version of the <a class="" href="../05/liquidity-mining-on-uniswap-v3/index.html">billion-dollar algorithm</a> used to track LP rewards in protocols like Compound and Uniswap.</p><p>Technically speaking, there are always two long-term order pools per TWAMM, one for each asset: for example, the pool selling USDC and the pool selling ETH. It just might be that one or both of these pools is empty at any given time.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h4 id="29cba9d7d204">Long-Term Order Expiration</h4><p>One complication arises when using order pooling in conjunction with lazy evaluation.</p><p>Imagine Bob places an order to sell 100 ETH over the next 100 blocks, and Charlie places an order to sell 200 ETH over the next 200 blocks. Both orders are selling at a rate of 1 ETH per block.</p><p>Suppose nobody interacts with the TWAMM for the next 150 blocks, at which point a new external interaction occurs. For the first 100 blocks after Bob and Charlie placed their orders, their orders were pooled into a common order selling 2 ETH per block. However, for the 50 blocks after that, Charlie&#x27;s order was on its own, selling only 1 ETH per block.</p><p>That means we have to do two separate trade calculations in order to find out what happened: one calculation for the results of the first 100 blocks, and one calculation for the final 50 blocks. In the worst case, if there had been orders expiring every block for the past 150 blocks, this would mean the TWAMM would have to process one trade per block, ruining gas efficiency.</p><p>The simplest workaround for this is to limit the number of blocks eligible for order expiry: for example, the TWAMM could specify that orders are only eligible to expire every 250 blocks, or roughly once per hour.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h4 id="74b91b5b2645">Canceling Long-Term Orders</h4><p>Users can cancel long-term orders at any time. In practice, this allows users to select the cancelation time for their order down to the block. This does not increase the gas burden for the system since the user who wants to cancel pays their own gas.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><h3 id="293d2d21de9b">Virtual Trade Math</h3></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h4 id="b076f46f4d0f">Definitions</h4><p>Assume it has been <em>t</em> blocks since the TWAMM last executed any virtual trades.</p><p>For the sake of simplicity, assume that no long-term orders have expired, so that the pool selling X was selling <span class="rich-text__math"><div><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>r</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">x_{rate}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></div></span> per block over the whole time period and the pool selling Y was selling <span class="rich-text__math"><div><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>r</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">y_{rate}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></div></span> per block over the whole time period.</p><p>Then the total amount of X sold over the period was <span class="rich-text__math"><div><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><msub><mi>x</mi><mrow><mi>r</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow></msub><mo>=</mo><msub><mi>x</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">tx_{rate} = x_{in}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></div></span> and the total amount of Y sold over the period was <span class="rich-text__math"><div><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><msub><mi>y</mi><mrow><mi>r</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow></msub><mo>=</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">ty_{rate}=y_{in}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></div></span>.</p><p>Let&#x27;s denote the embedded AMM reserves at the beginning of the time period as <span class="rich-text__math"><div><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>a</mi><mi>m</mi><mi>m</mi><mi>S</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">x_{ammStart}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">amm</span><span class="mord mathnormal mtight">St</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></div></span> and <span class="rich-text__math"><div><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>a</mi><mi>m</mi><mi>m</mi><mi>S</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">y_{ammStart}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">amm</span><span class="mord mathnormal mtight">St</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></div></span>, respectively.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h4 id="e1038e4b2294">Formulas</h4><p>After all virtual trades are processed the embedded AMM will have X reserves of</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-math my-0 mx-auto"><div><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>x</mi><mrow><mi>a</mi><mi>m</mi><mi>m</mi><mi>E</mi><mi>n</mi><mi>d</mi></mrow></msub><mo>=</mo><msqrt><mfrac><mrow><mi>k</mi><msub><mi>x</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub></mrow><msub><mi>y</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub></mfrac></msqrt><mfrac><mrow><msup><mi>e</mi><mrow><mn>2</mn><msqrt><mfrac><mrow><msub><mi>x</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><msub><mi>y</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub></mrow><mi>k</mi></mfrac></msqrt></mrow></msup><mo>+</mo><mi>c</mi></mrow><mrow><msup><mi>e</mi><mrow><mn>2</mn><msqrt><mfrac><mrow><msub><mi>x</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><msub><mi>y</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub></mrow><mi>k</mi></mfrac></msqrt></mrow></msup><mo>−</mo><mi>c</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">x_{ammEnd} = \sqrt{\frac{kx_{in}}{y_{in}}}\frac{e^{2\sqrt{\frac{x_{in}y_{in}}{k}}}+c}{e^{2\sqrt{\frac{x_{in}y_{in}}{k}}}-c}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">amm</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.04em;vertical-align:-1.1606em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8794em;"><span class="svg-align" style="top:-5em;"><span class="pstrut" style="height:5em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.8394em;"><span class="pstrut" style="height:5em;"></span><span class="hide-tail" style="min-width:1.02em;height:3.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='3.08em' viewBox='0 0 400000 3240' preserveAspectRatio='xMinYMin slice'><path d='M473,2793
c339.3,-1799.3,509.3,-2700,510,-2702 l0 -0
c3.3,-7.3,9.3,-11,18,-11 H400000v40H1017.7
s-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200
c0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26
s76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,
606zM1001 80h400000v40H1017.7z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1606em;"><span></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8043em;"><span style="top:-2.11em;"><span class="pstrut" style="height:3.1273em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.1274em;"><span style="top:-3.3974em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0428em;"><span class="svg-align" style="top:-3.4286em;"><span class="pstrut" style="height:3.4286em;"></span><span class="mord mtight" style="padding-left:1.19em;"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8558em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.5483em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:0em;margin-right:0.1em;"><span class="pstrut" style="height:2.6595em;"></span><span class="mord mtight"><span class="mord mathnormal mtight">in</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3147em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:-0.0359em;margin-right:0.1em;"><span class="pstrut" style="height:2.6595em;"></span><span class="mord mtight"><span class="mord mathnormal mtight">in</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3147em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span><span style="top:-3.0148em;"><span class="pstrut" style="height:3.4286em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.5429em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.5429em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4137em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">c</span></span></span><span style="top:-3.3573em;"><span class="pstrut" style="height:3.1273em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.8043em;"><span class="pstrut" style="height:3.1273em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.1274em;"><span style="top:-3.3974em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0428em;"><span class="svg-align" style="top:-3.4286em;"><span class="pstrut" style="height:3.4286em;"></span><span class="mord mtight" style="padding-left:1.19em;"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8558em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.5483em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:0em;margin-right:0.1em;"><span class="pstrut" style="height:2.6595em;"></span><span class="mord mtight"><span class="mord mathnormal mtight">in</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3147em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:-0.0359em;margin-right:0.1em;"><span class="pstrut" style="height:2.6595em;"></span><span class="mord mtight"><span class="mord mathnormal mtight">in</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3147em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span><span style="top:-3.0148em;"><span class="pstrut" style="height:3.4286em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.5429em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.5429em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4137em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1007em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></div></div><div class="relative hidden xl:block row-start-1 w-[250px] pl-1"></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><p>where</p></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-math my-0 mx-auto"><div><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>c</mi><mo>=</mo><mfrac><mrow><msqrt><mrow><msub><mi>x</mi><mrow><mi>a</mi><mi>m</mi><mi>m</mi><mi>S</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi></mrow></msub><msub><mi>y</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub></mrow></msqrt><mo>−</mo><msqrt><mrow><msub><mi>y</mi><mrow><mi>a</mi><mi>m</mi><mi>m</mi><mi>S</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi></mrow></msub><msub><mi>x</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub></mrow></msqrt></mrow><mrow><msqrt><mrow><msub><mi>x</mi><mrow><mi>a</mi><mi>m</mi><mi>m</mi><mi>S</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi></mrow></msub><msub><mi>y</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub></mrow></msqrt><mo>+</mo><msqrt><mrow><msub><mi>y</mi><mrow><mi>a</mi><mi>m</mi><mi>m</mi><mi>S</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi></mrow></msub><msub><mi>x</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub></mrow></msqrt></mrow></mfrac></mrow><annotation encoding="application/x-tex">c = \frac{\sqrt{x_{ammStart}y_{in}}-\sqrt{y_{ammStart}x_{in}}}{\sqrt{x_{ammStart}y_{in}}+\sqrt{y_{ammStart}x_{in}}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4529em;vertical-align:-1.0229em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.43em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7031em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">amm</span><span class="mord mathnormal mtight">St</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.6631em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3369em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7031em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">amm</span><span class="mord mathnormal mtight">St</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.6631em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3369em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.7269em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7031em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">amm</span><span class="mord mathnormal mtight">St</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.6631em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3369em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7031em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">amm</span><span class="mord mathnormal mtight">St</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.6631em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3369em;"><span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.0229em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></div></div><div class="relative hidden xl:block row-start-1 w-[250px] pl-1"></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><p>From the constant product formula, we know:</p></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-math my-0 mx-auto"><div><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>y</mi><mrow><mi>a</mi><mi>m</mi><mi>m</mi><mi>E</mi><mi>n</mi><mi>d</mi></mrow></msub><mo>=</mo><mfrac><mrow><msub><mi>x</mi><mrow><mi>a</mi><mi>m</mi><mi>m</mi><mi>S</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi></mrow></msub><msub><mi>y</mi><mrow><mi>a</mi><mi>m</mi><mi>m</mi><mi>S</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi></mrow></msub></mrow><msub><mi>x</mi><mrow><mi>a</mi><mi>m</mi><mi>m</mi><mi>E</mi><mi>n</mi><mi>d</mi></mrow></msub></mfrac></mrow><annotation encoding="application/x-tex">y_{ammEnd}=\frac{x_{ammStart}y_{ammStart}}{x_{ammEnd}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">amm</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.9436em;vertical-align:-0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">amm</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">amm</span><span class="mord mathnormal mtight">St</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">amm</span><span class="mord mathnormal mtight">St</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></div></div><div class="relative hidden xl:block row-start-1 w-[250px] pl-1"></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><p>The pool selling X gets all of the Y that didn&#x27;t end up in the embedded AMM — in other words,</p></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-math my-0 mx-auto"><div><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>y</mi><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow></msub><mo>=</mo><msub><mi>y</mi><mrow><mi>a</mi><mi>m</mi><mi>m</mi><mi>S</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi></mrow></msub><mo>+</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo>−</mo><msub><mi>y</mi><mrow><mi>a</mi><mi>m</mi><mi>m</mi><mi>E</mi><mi>n</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">y_{out} = y_{ammStart} + y_{in} - y_{ammEnd}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">amm</span><span class="mord mathnormal mtight">St</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">amm</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></div></div><div class="relative hidden xl:block row-start-1 w-[250px] pl-1"></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><p>and similarly,</p></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-math my-0 mx-auto"><div><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>x</mi><mrow><mi>o</mi><mi>u</mi><mi>t</mi></mrow></msub><mo>=</mo><msub><mi>x</mi><mrow><mi>a</mi><mi>m</mi><mi>m</mi><mi>S</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi></mrow></msub><mo>+</mo><msub><mi>x</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub><mo>−</mo><msub><mi>x</mi><mrow><mi>a</mi><mi>m</mi><mi>m</mi><mi>E</mi><mi>n</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">x_{out} = x_{ammStart} + x_{in} - x_{ammEnd}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">amm</span><span class="mord mathnormal mtight">St</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">amm</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></div></div><div class="relative hidden xl:block row-start-1 w-[250px] pl-1"></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><h2 id="96cbae52ba61">Potential Attack Vectors</h2></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><h4 id="07bfda9e3852">Sandwich Attacks</h4></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h4 id="7606f8d155e5">Description</h4><p>In a <a class="" href="https://research.paradigm.xyz/MEV">sandwich attack</a>, an attacker, Atticus, sees that a trader, Trey, is about to do a trade on an AMM. Atticus sends two orders that <em>sandwich</em> Trey&#x27;s, thereby extracting a profit from it.</p><p>Imagine Trey sends an order to buy ETH with USDC to an AMM. Seeing this, Atticus places an order to buy ETH on the AMM before Trey does, driving the price up. Because he is paying fees to the AMM and incurring price impact, Atticus is losing money on this order.</p><p>When Trey&#x27;s order is filled, he buys the ETH at a higher price than he would have otherwise had to, because Atticus has pushed prices up. Trey&#x27;s order drives the price up even higher.</p><p>Now, Atticus sells his ETH back to the AMM. Because Trey has pushed prices on the AMM up since Trey bought, he sells for more than he bought and is able to realize a profit.</p><p>This attack only makes sense for Atticus if he is able to guarantee that he will be able to sell his ETH back to the AMM immediately after Trey buys. Within a given block, this is possible if Atticus is a miner, makes a deal with one, or uses a service like <a class="" href="https://medium.com/flashbots/frontrunning-the-mev-crisis-40629a613752">Flashbots</a>.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h4 id="5d968a801c92">Sandwiching and Virtual Orders</h4><p>At first glance, virtual orders may seem especially vulnerable to sandwich attacks because everybody knows they are coming.</p><p>However, they are saved by the fact that they execute between **blocks. An attacker wishing to sandwich the TWAMM&#x27;s virtual orders would have to trade against the embedded AMM at the end of one block, causing the virtual orders to execute at a bad price between blocks, and then trade in the other direction to close the trade at the beginning of the <em>next</em> block.</p><p>At present, there is no way for an attacker to guarantee that they will only trade at the end of a given block if they also get to trade at the beginning of the next block. When such <em>multi-block MEV</em> becomes more common, allowing traders to sandwich across multiple blocks, this may become more of an issue.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h3 id="ecd6b3ba7bdc">Information Leakage</h3><p>The biggest tradeoff long-term traders are likely to encounter with the TWAMM is the <em>information leakage</em> they are exposed to when placing publicly visible orders, which are necessary due to the nature of Ethereum.</p><p>If a trader places a sufficiently large long-term order, other traders may be tempted to <em>front-run</em> it, buying up the asset on the TWAMM&#x27;s embedded AMM and elsewhere in order to sell it back to the trader later as the long-term order pushes prices up.</p><p>Because users can cancel their long-term orders at any time, we expect overly aggressive front-runners to be exploited by other traders, keeping the overall impact of information leakage in check.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h4 id="7e0a6183220b">Example</h4><p>Imagine Sally the spoofer has noticed aggressive front-running on the TWAMM. She buys one million USDC of ETH from a liquidity aggregator, pushing up prices across the market. Then she places a massive long-term order on the TWAMM to buy one hundred thousand USDC of ETH per block for the next 24 hours.</p><p>Immediately, Frank the front-runner sees this order and buys one million USDC of ETH through the aggregator, pushing up prices even further. Sally sells back her ETH through the aggregator for a profit, pushing prices back down and leaving Frank with a loss. Finally, she cancels her long-term order before any of it is filled.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h2 id="e9a4b8c5ef35">Python Reference Implementation</h2><p>You can see a Python reference implementation of the TWAMM <a class="" href="https://github.com/para-dave/twamm">here</a>.</p><p><a class="" href="https://github.com/para-dave/twamm/blob/master/twamm_demo.ipynb">This Jupyter notebook</a> demonstrates the behavior of the TWAMM with multiple offsetting long-term orders and arbitrageurs.</p><p>For the sake of simplicity, this Python version does not implement gas optimizations like pooled orders or true lazy evaluation.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><div><h2 id="d270dc215f3a">Conclusion</h2><p>We&#x27;ve sketched out the design of the TWAMM, but our work is just beginning.</p><p>If you are interested in working on this or similar problems, you can email <a class="" href="mailto:dave@paradigm.xyz">dave@paradigm.xyz</a> or <a class="" href="https://twitter.com/messages/compose?recipient_id=1184231093576392704">DM me on Twitter</a>, or reach out to Uniswap Labs at <a class="" href="mailto:ideas@uniswap.org">ideas@uniswap.org</a>.</p></div></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div><div class="my-2 md:my-4"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-8 xl:col-start-4 flex flex-row gap-10 max-w-[1250px]"><div class="rich-text line-break rich-text-post text-serif-16 md:text-serif-18 leading-28"><p><em>Acknowledgments: <a class="" href="https://twitter.com/samczsun">Sam Sun</a>, <a class="" href="https://twitter.com/gakonst">Georgios Konstantopoulos</a>, <a class="" href="https://twitter.com/euler_mab">Michael Bently</a>, <a class="" href="https://twitter.com/MMKustermann">Michael Kustermann,</a> <a class="" href="https://twitter.com/kevinxpang">Kevin Pang</a>, <a class="" href="https://twitter.com/hasufl">Hasu</a>, <a class="" href="https://twitter.com/SBF_Alameda">Sam Bankman-Fried</a>, <a class="" href="https://twitter.com/priorupdates">Henry Prior</a>, <a class="" href="https://www.linkedin.com/in/tom-cadwell-404b49">Tom Cadwell</a>, <a class="" href="https://twitter.com/AWice">Alex Wice</a>, <a class="" href="https://twitter.com/mewn21">Mewny</a>, <a class="" href="https://twitter.com/bigmagicdao">Big Magic</a>, <a class="" href="https://twitter.com/nope_its_lily">Lily Francus</a>, Tarun Chitra, <a class="" href="https://twitter.com/sendmoodz?lang=en">Moody Salem</a>, <a class="" href="https://twitter.com/NoahZinsmeister">Noah Zinsmeister</a>, <a class="" href="https://twitter.com/teo_leibowitz?lang=en">Teo Leibowitz</a></em></p></div><div class="relative hidden xl:block row-start-1 max-w-[250px] pl-1" style="opacity:1"><div class="flex flex-col gap-3 min-w-[250px]"></div></div></div></div></div></div></div><footer class="px-container-mobile md:px-container-desktop py-7 md:py-8 md:pb-7"><div class="grid grid-cols-12"><div class="col-span-12 md:col-start-2 md:col-span-9 xl:col-span-5 xl:col-start-4 flex flex-row gap-10 max-w-[900px]"><div class="flex flex-col gap-6 max-w-[900px]"><div class="flex flex-col gap-2"><h3 class="font-mono text-mono-12 font-medium">Written by</h3><div class="font-mono text-mono-12"><span class="content-none after:content-[&#x27;,&#x27;] pr-1"><a class="link-underline-hover" href="../../team/davewhite/index.html">Dave White</a></span><span class="content-none after:content-[&#x27;,&#x27;] pr-1"><a class="link-underline-hover" href="../../team/dan-mccarthy.html">Dan McCarthy</a></span><span class="content-none"><a _key="438948226a29" class="link-underline-hover" href="https://twitter.com/haydenzadams">Hayden Adams</a></span></div></div><div class="rich-text line-break font-mono text-mono-12"><p>Disclaimer: This post is for general information purposes only. It does not constitute investment advice or a recommendation or solicitation to buy or sell any investment and should not be used in the evaluation of the merits of making any investment decision. It should not be relied upon for accounting, legal or tax advice or investment recommendations. This post reflects the current opinions of the authors and is not made on behalf of Paradigm or its affiliates and does not necessarily reflect the opinions of Paradigm, its affiliates or individuals associated with Paradigm. The opinions reflected herein are subject to change without being updated.</p></div></div></div></div></footer><div class="p-3 md:pt-6 bg-black text-white font-mono text-mono-12"><div class="flex flex-col gap-6"><div class="grid grid-cols-12 gap-y-6"><div class="col-span-12 md:col-span-3"><div class="flex"><svg width="94" height="108" viewBox="0 0 94 108" class="text-green block w-[53px] h-[60px] md:w-[94px] md:h-[108px]"><path d="M94 33.2314L36.1538 0L28.9231 4.15692V12.4628L21.6923 8.30585L14.4615 12.4628V20.7686L7.23077 16.6117L0 20.7686V87.2314L7.23077 91.3883L14.4615 87.2314V95.5372L21.6923 99.6942L28.9231 95.5372V103.843L36.1538 108L94 74.7686V66.4628L86.7692 62.3059L94 58.1489V49.8431L86.7692 45.6862L94 41.5292V33.2314ZM14.4615 78.9255L7.23077 83.0825V24.9255L14.4615 29.0825V78.9255ZM36.1538 83.0745V74.7686L65.0769 58.1569L72.3077 62.3138L36.1538 83.0745ZM57.8462 54L36.1538 66.4628V41.5372L57.8462 54ZM65.0769 49.8431L36.1538 33.2314V24.9255L72.3077 45.6942L65.0769 49.8431ZM21.6923 16.6117L28.9231 20.7686V29.0745L21.6923 24.9175V16.6117ZM21.6923 33.2314L28.9231 37.3883V70.6197L21.6923 74.7766V33.2314ZM21.6923 83.0745L28.9231 78.9175V87.2234L21.6923 91.3803V83.0745ZM86.7692 70.6117L36.1538 99.6862V91.3803L79.5385 66.4548L86.7692 70.6117ZM86.7692 54L79.5385 58.1569L72.3077 54L79.5385 49.8431L86.7692 54ZM79.5385 41.5372L36.1538 16.6117V8.30585L86.7692 37.3803L79.5385 41.5372Z" fill="currentColor"></path></svg></div></div><div class="col-span-12 md:col-span-6 flex flex-col gap-6"><div class="grid md:grid-cols-3 gap-y-1"><div><ul class="flex flex-col gap-1"><li><a _key="c617717bef10" class="link-underline-hover uppercase font-medium" href="../../about.html">About</a></li><li><a _key="445b500c20cd" class="link-underline-hover uppercase font-medium" href="../../team.html">Team</a></li><li><a _key="ae321ba66fad" class="link-underline-hover uppercase font-medium" href="../../portfolio.html">Portfolio</a></li></ul></div><div><ul class="flex flex-col gap-1"><li><a _key="6862d607fb16" class="link-underline-hover uppercase font-medium" href="../../writing.html">Writing</a></li><li><a _key="ce7b888d0e75" class="link-underline-hover uppercase font-medium" href="../../oss.html">Open Source</a></li><li><a _key="927788bfed4f" class="link-underline-hover uppercase font-medium" href="../../careers.html">Careers</a></li></ul></div><div><ul class="flex flex-col gap-1"><li><a _key="02f85bf11b4a" class="link-underline-hover uppercase font-medium" target="_blank" rel="noopener noreferrer" href="https://app.junipersquare.com/i/paradigm">LP Login</a></li></ul></div></div><div class="grid md:grid-cols-3 gap-y-1"><div><a _key="f325e52a9ec5" class="link-underline-hover" target="_blank" rel="noopener noreferrer" href="https://twitter.com/paradigm">Twitter</a></div><div><a _key="f231f3484f95" class="link-underline-hover" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/company/paradigm-xyz/">LinkedIn</a></div><div><a _key="1c198033e797" class="link-underline-hover" target="_blank" rel="noopener noreferrer" href="https://warpcast.com/paradigm">Warpcast</a></div><div><a _key="d8394a8a29cb" class="link-underline-hover" href="../../contact.html">Contact</a></div></div></div></div><div class="grid grid-cols-12 items-end gap-y-6"><div class="col-span-12 md:col-span-3"><ul class="flex flex-col gap-1"><li><a _key="d6e347271e47" class="link-underline-hover" href="../../website-terms-of-use.html">Terms</a></li><li><a _key="29e55cad5ff7" class="link-underline-hover" href="../../important-disclosures.html">Disclosures</a></li><li><a _key="02e810af4cf8" class="link-underline-hover" href="../../privacy-policy.html">Privacy</a></li><li><a _key="520d04d2ff65" class="link-underline-hover" href="../../privacy-policy.html#83a48e65d92d">CA Privacy</a></li></ul></div><div class="col-span-12 md:col-span-6"><p>Copyright © 2025 Paradigm Operations LP All rights reserved. “Paradigm” is a trademark, and the triangular mobius symbol is a registered trademark of Paradigm Operations LP</p></div><div class="col-span-12 md:col-span-3"><div class="flex justify-between md:justify-end"><div class="tag block md:hidden"></div><div class="tag"></div></div></div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"layout":{"header":{"mobileSmallLinks":[{"_key":"8fb4f75b65fa","title":"LP Login","url":"https://app.junipersquare.com/i/paradigm","openInNewWindow":true,"_type":"link"}],"socialLinks":[{"_type":"link","_key":"389a7a5bd2b7","title":"Twitter","url":"https://twitter.com/paradigm","openInNewWindow":true},{"_type":"link","_key":"309ee4c0c92b","title":"LinkedIn","url":"https://www.linkedin.com/company/paradigm-xyz/","openInNewWindow":true},{"url":"https://warpcast.com/paradigm","openInNewWindow":true,"_type":"link","_key":"caa5dd28bb8e","title":"Warpcast"},{"openInNewWindow":null,"title":null,"pageName":"Contact","slug":"contact","page":{"_ref":"57df6e24-c479-4932-861a-f7b349880f5f","_type":"reference"},"_key":"c747bb27efab","_type":"pageLink"}],"legalLinks":[{"page":{"_ref":"d33b5b91-90eb-4b9f-9eba-d894012bcc53","_type":"reference"},"_key":"798f6ddf0d55","title":"Terms","_type":"pageLink","pageName":"Website Terms of Use","slug":"website-terms-of-use","openInNewWindow":null},{"openInNewWindow":null,"pageName":"Important Disclosures","slug":"important-disclosures","_key":"a5c485dc29ed","title":"Disclosures","_type":"pageLink","page":{"_ref":"c7027d0e-71a0-4bc4-b4ad-61cd2c3685a7","_type":"reference"}},{"page":{"_ref":"081c96bd-e746-495c-998f-dc5e1421b55e","_type":"reference"},"_key":"d66378d18c1a","title":"Privacy","_type":"pageLink","openInNewWindow":null,"pageName":"Privacy Policy","slug":"privacy-policy"},{"_type":"link","_key":"e8f366883ed3","title":"CA Privacy","url":"/privacy-policy#83a48e65d92d","openInNewWindow":false}],"desktopLinks":[{"slug":"about","_type":"pageLink","page":{"_ref":"8a0be9a1-8ab7-4a76-9d11-5b0d2636b14e","_type":"reference"},"_key":"426608038e76","openInNewWindow":null,"title":null,"pageName":"About"},{"_type":"link","_key":"ff5f78089e91","title":"Team","url":"/team","openInNewWindow":null},{"title":null,"pageName":"Portfolio","slug":"portfolio","_type":"pageLink","page":{"_type":"reference","_ref":"5413381f-bafa-4f3e-bba8-91d912b8db45"},"_key":"38b3cd4525de","openInNewWindow":null},{"title":"Writing","url":"/writing","_type":"link","_key":"22b86a453ca1","openInNewWindow":null},{"page":{"_ref":"cd2cf7f4-c943-4bfe-928b-ee045fba8a9f","_type":"reference"},"_key":"cd5b2c9fbd5f","openInNewWindow":null,"title":null,"pageName":"Open Source","slug":"oss","_type":"pageLink"},{"openInNewWindow":null,"_key":"05b4198b2e14","title":"Careers","url":"/careers","_type":"link"}],"mobileLinks":[{"page":{"_ref":"8a0be9a1-8ab7-4a76-9d11-5b0d2636b14e","_type":"reference"},"title":null,"pageName":"About","slug":"about","openInNewWindow":null,"_key":"ad3cf4299bd8","_type":"pageLink"},{"_type":"link","_key":"cdc21cfec068","title":"Team","url":"/team","openInNewWindow":null},{"title":null,"pageName":"Portfolio","slug":"portfolio","openInNewWindow":null,"_key":"56f654c719a3","_type":"pageLink","page":{"_ref":"5413381f-bafa-4f3e-bba8-91d912b8db45","_type":"reference"}},{"_type":"link","_key":"f8ada95cbc04","title":"Writing","url":"/writing","openInNewWindow":null},{"_key":"8e6834f3c151","_type":"pageLink","page":{"_type":"reference","_ref":"cd2cf7f4-c943-4bfe-928b-ee045fba8a9f"},"openInNewWindow":null,"title":null,"pageName":"Open Source","slug":"oss"},{"_key":"027927bd5b1f","title":"Careers","url":"/careers","_type":"link","openInNewWindow":null}]},"footer":{"linkColumns":[{"_key":"520a97f1c3b3","links":[{"slug":"about","_type":"pageLink","page":{"_ref":"8a0be9a1-8ab7-4a76-9d11-5b0d2636b14e","_type":"reference"},"_key":"c617717bef10","openInNewWindow":null,"title":null,"pageName":"About"},{"_type":"pageLink","page":{"_ref":"c0cc1f2f-202f-4d37-b5bb-dc9edb7edf62","_type":"reference"},"_key":"445b500c20cd","openInNewWindow":null,"title":null,"pageName":"Team","slug":"team"},{"title":null,"pageName":"Portfolio","_key":"ae321ba66fad","_type":"pageLink","page":{"_type":"reference","_ref":"5413381f-bafa-4f3e-bba8-91d912b8db45"},"slug":"portfolio","openInNewWindow":null}]},{"_key":"0d51d5f77b26","links":[{"title":null,"pageName":"Writing","slug":"writing","_type":"pageLink","page":{"_ref":"c4ba5025-72c6-4c4d-a5a1-c46dfcce2cea","_type":"reference"},"_key":"6862d607fb16","openInNewWindow":null},{"title":null,"pageName":"Open Source","page":{"_ref":"cd2cf7f4-c943-4bfe-928b-ee045fba8a9f","_type":"reference"},"_key":"ce7b888d0e75","_type":"pageLink","slug":"oss","openInNewWindow":null},{"_type":"link","openInNewWindow":null,"_key":"927788bfed4f","title":"Careers","url":"/careers"}]},{"_key":"efc2b524a0f6","links":[{"url":"https://app.junipersquare.com/i/paradigm","openInNewWindow":true,"_type":"link","_key":"02f85bf11b4a","title":"LP Login"}]}],"socialLinks":[{"openInNewWindow":true,"_type":"link","_key":"f325e52a9ec5","title":"Twitter","url":"https://twitter.com/paradigm"},{"_key":"f231f3484f95","title":"LinkedIn","url":"https://www.linkedin.com/company/paradigm-xyz/","openInNewWindow":true,"_type":"link"},{"_type":"link","_key":"1c198033e797","title":"Warpcast","url":"https://warpcast.com/paradigm","openInNewWindow":true},{"pageName":"Contact","slug":"contact","_type":"pageLink","page":{"_ref":"57df6e24-c479-4932-861a-f7b349880f5f","_type":"reference"},"_key":"d8394a8a29cb","openInNewWindow":null,"title":null}],"legalLinks":[{"pageName":"Website Terms of Use","slug":"website-terms-of-use","openInNewWindow":null,"page":{"_ref":"d33b5b91-90eb-4b9f-9eba-d894012bcc53","_type":"reference"},"_key":"d6e347271e47","title":"Terms","_type":"pageLink"},{"_type":"pageLink","page":{"_ref":"c7027d0e-71a0-4bc4-b4ad-61cd2c3685a7","_type":"reference"},"_key":"29e55cad5ff7","title":"Disclosures","openInNewWindow":null,"pageName":"Important Disclosures","slug":"important-disclosures"},{"pageName":"Privacy Policy","slug":"privacy-policy","page":{"_ref":"081c96bd-e746-495c-998f-dc5e1421b55e","_type":"reference"},"_key":"02e810af4cf8","title":"Privacy","_type":"pageLink","openInNewWindow":null},{"url":"/privacy-policy#83a48e65d92d","openInNewWindow":false,"_type":"link","_key":"520d04d2ff65","title":"CA Privacy"}],"legalStatement":"Copyright © [YEAR] Paradigm Operations LP All rights reserved. “Paradigm” is a trademark, and the triangular mobius symbol is a registered trademark of Paradigm Operations LP"},"postDisclaimer":{"disclaimer":[{"style":"normal","_key":"45dda89c171b","asset":null,"markDefs":[],"children":[{"_type":"span","marks":[],"text":"Disclaimer: This post is for general information purposes only. It does not constitute investment advice or a recommendation or solicitation to buy or sell any investment and should not be used in the evaluation of the merits of making any investment decision. It should not be relied upon for accounting, legal or tax advice or investment recommendations. This post reflects the current opinions of the authors and is not made on behalf of Paradigm or its affiliates and does not necessarily reflect the opinions of Paradigm, its affiliates or individuals associated with Paradigm. The opinions reflected herein are subject to change without being updated.","_key":"da9bfb35a7960"}],"_type":"block"}]},"careersIndex":{"indexTitle":"Opportunities","description":[{"markDefs":[],"children":[{"_type":"span","marks":[],"text":"Browse through careers and opportunities in the Paradigm universe.","_key":"fdbf7aeff6590"}],"_type":"block","style":"normal","_key":"6663134c09b3","asset":null}]}},"config":{"seo":{"disallowRobots":null,"metaDescription":"Paradigm is a research-driven crypto investment firm that funds companies and protocols from their earliest stages.","openGraphDescription":"Paradigm is a research-driven crypto investment firm that funds companies and protocols from their earliest stages.","twitterTitle":"Paradigm","twitterImage":{"dimensions":{"_type":"sanity.imageDimensions","width":2400,"aspectRatio":1.9047619047619047,"height":1260},"url":"https://cdn.sanity.io/images/dgybcd83/production/fd732ebeb1c4d286fd7e3b5b25395d72452edeb6-2400x1260.png","_type":"image","_key":null,"alt":null,"lqip":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABa0lEQVQokX1Su47CMBD0T9PQU/ML/MBVFCBRUlAgJIQUBQVOPAyBEMgLbOJc7DnZRyAEuI1W2qzXs7OzJqiY0p9Sf7FSb704E0IgCAJ4nmfcdV2QKuAd+HaxGkM9cmmawvd9bDYbrNdrzGYzkGrX8r9UErGMQX8o/NyHUOKpRgPu93vM53NMp1OMx+MHYBVUG1ccw3SI1rmFL/YFJ3MMaFGX5zmSJDEMNeBoNHqM/E4nza7N26gFNdTDOjq8g0QmT/VSSlyvVxyPRyyXSxDd5ZPwZ3lGj/fQiBpoxk0M0gGYZK+6AoatloBcLhcTFMDlTTPBYIUWul4Xfa8PGlOI7KYjXgloI3rdYRiCMWaegR6hKNI56lLY3zZsxwal1OTKeqMiF9lut2ZTu90Oh8MBnPP7YZZl0BNEYYTT6YQoiu4My0DlmKxWKywWC7Mlx3EMW82y2vm/11A2YlkWJpOJcdu2DZMy4Dv7lNeAv2hnUK/yFW33AAAAAElFTkSuQmCC"},"hideFromSitemap":null,"metaTitle":"Paradigm","metaKeywords":null,"openGraphTitle":"Paradigm","openGraphImage":{"lqip":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABa0lEQVQokX1Su47CMBD0T9PQU/ML/MBVFCBRUlAgJIQUBQVOPAyBEMgLbOJc7DnZRyAEuI1W2qzXs7OzJqiY0p9Sf7FSb704E0IgCAJ4nmfcdV2QKuAd+HaxGkM9cmmawvd9bDYbrNdrzGYzkGrX8r9UErGMQX8o/NyHUOKpRgPu93vM53NMp1OMx+MHYBVUG1ccw3SI1rmFL/YFJ3MMaFGX5zmSJDEMNeBoNHqM/E4nza7N26gFNdTDOjq8g0QmT/VSSlyvVxyPRyyXSxDd5ZPwZ3lGj/fQiBpoxk0M0gGYZK+6AoatloBcLhcTFMDlTTPBYIUWul4Xfa8PGlOI7KYjXgloI3rdYRiCMWaegR6hKNI56lLY3zZsxwal1OTKeqMiF9lut2ZTu90Oh8MBnPP7YZZl0BNEYYTT6YQoiu4My0DlmKxWKywWC7Mlx3EMW82y2vm/11A2YlkWJpOJcdu2DZMy4Dv7lNeAv2hnUK/yFW33AAAAAElFTkSuQmCC","dimensions":{"height":1260,"_type":"sanity.imageDimensions","width":2400,"aspectRatio":1.9047619047619047},"url":"https://cdn.sanity.io/images/dgybcd83/production/fd732ebeb1c4d286fd7e3b5b25395d72452edeb6-2400x1260.png","_type":"image","_key":null,"alt":null},"twitterDescription":"Paradigm is a research-driven crypto investment firm that funds companies and protocols from their earliest stages."}},"passwordProtection":{"enablePassword":false,"password":"paradigm"},"featuredImageCaption":null,"seo":{"twitterTitle":null,"disallowRobots":null,"metaTitle":null,"openGraphTitle":"TWAMM","openGraphImage":{"alt":null,"lqip":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABYElEQVQokX1T2Q6CQBDbRxVF8UBUgnjihScaFU2M//9PNW2iiXg8FHZnp2WmO5h8Po9fyOVyb+tqtYrlconz+YzhcIhisfiWQxgGvuHbB2q1GlarFS6XC6Iogm3bHxxjWRZKpZIOCe6fFWVRLpcxnU4luF6v4XmeuOSQ22g0YPhot9sIggBhGML3fVVCsuM4WrPVSqUiwmQykWCappjP5+h2u+IMBgNVb3q9nvwYj8dKYJBv7lkNPYvjGIvFQlUdj0dcr1cJcp0kCXa7HQ6Hg7w1s9kMo9EIFCYodjqdRNhsNhKjKMVI3G63yqGHjCdJIjDOven3+2i1Wq/WOp2OiLfbTVW5rqt4vV5Xy3yzfVrCM9/3ZRd5zWYThgfPiygUCkqmTxRkhRT7NwmWZb1A/sfYcLboKQXpC6v4N6dZmGwCr58V3u937Pd7tfltyH995EOQo8KbpiAvgt7++5uygg8noxks44aE8wAAAABJRU5ErkJggg==","dimensions":{"_type":"sanity.imageDimensions","width":2400,"aspectRatio":1.7777777777777777,"height":1350},"url":"https://cdn.sanity.io/images/dgybcd83/production/0690a51019f0ec9694e9509c86e5b9303fa6f35e-2400x1350.png","_type":"image","_key":null},"twitterDescription":null,"twitterImage":null,"hideFromSitemap":null,"metaDescription":null,"metaKeywords":null,"openGraphDescription":"This paper introduces a new type of automated market maker, or AMM, that helps traders on Ethereum efficiently execute large orders -- The time-weighted average market maker, or TWAMM (pronounced \"tee-wham\")."},"_id":"2c73058f-9cfd-49bf-9bb4-a2360857f952","publishDate":"2021-07-28","tags":[{"_id":"493e238e-72b6-4c77-9dcf-35f015c39025","slug":"research","title":"Research"}],"summary":"This paper introduces a new type of automated market maker, or AMM, that helps traders on Ethereum efficiently execute large orders -- The time-weighted average market maker, or TWAMM (pronounced \"tee-wham\").","featuredImage":{"url":"https://cdn.sanity.io/images/dgybcd83/production/0690a51019f0ec9694e9509c86e5b9303fa6f35e-2400x1350.png","_type":"imageAlt","_key":null,"alt":null,"lqip":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABYElEQVQokX1T2Q6CQBDbRxVF8UBUgnjihScaFU2M//9PNW2iiXg8FHZnp2WmO5h8Po9fyOVyb+tqtYrlconz+YzhcIhisfiWQxgGvuHbB2q1GlarFS6XC6Iogm3bHxxjWRZKpZIOCe6fFWVRLpcxnU4luF6v4XmeuOSQ22g0YPhot9sIggBhGML3fVVCsuM4WrPVSqUiwmQykWCappjP5+h2u+IMBgNVb3q9nvwYj8dKYJBv7lkNPYvjGIvFQlUdj0dcr1cJcp0kCXa7HQ6Hg7w1s9kMo9EIFCYodjqdRNhsNhKjKMVI3G63yqGHjCdJIjDOven3+2i1Wq/WOp2OiLfbTVW5rqt4vV5Xy3yzfVrCM9/3ZRd5zWYThgfPiygUCkqmTxRkhRT7NwmWZb1A/sfYcLboKQXpC6v4N6dZmGwCr58V3u937Pd7tfltyH995EOQo8KbpiAvgt7++5uygg8noxks44aE8wAAAABJRU5ErkJggg==","dimensions":{"_type":"sanity.imageDimensions","width":2400,"aspectRatio":1.7777777777777777,"height":1350}},"tableOfContents":true,"content":[{"_type":"richTextBlock","_key":"a5717fd6c4b5","content":[{"markDefs":[],"children":[{"_key":"84ca074f97420","_type":"span","marks":[],"text":"Introduction"}],"_type":"block","style":"h2","_key":"db1abe0ececc","asset":null},{"style":"normal","_key":"43cc5890e6e0","markDefs":[],"children":[{"marks":[],"text":"This paper introduces a new type of automated market maker, or AMM, that helps traders on Ethereum efficiently execute large orders.","_key":"6a0291d251850","_type":"span"}],"_type":"block","asset":null},{"style":"normal","_key":"ce5fc2feb96f","markDefs":[],"children":[{"_type":"span","marks":[],"text":"We call it the ","_key":"b895681946040"},{"text":"time-weighted average market maker","_key":"b895681946041","_type":"span","marks":["em"]},{"_type":"span","marks":[],"text":", or TWAMM (pronounced \"tee-wham\").","_key":"b895681946042"}],"_type":"block","asset":null},{"markDefs":[],"children":[{"text":"It works by breaking long-term orders into infinitely many infinitely small pieces and executing them against an embedded constant-product AMM smoothly over time.","_key":"e5761d222ef20","_type":"span","marks":[]}],"_type":"block","style":"normal","_key":"4977b4349793","asset":null}]},{"_type":"richTextBlock","_key":"544024df7c4b","content":[{"children":[{"_type":"span","marks":[],"text":"Summary","_key":"a5156eed17130"}],"_type":"block","style":"h2","_key":"5b4dc46a1c39","markDefs":[],"asset":null},{"markDefs":[],"asset":null,"children":[{"marks":[],"text":"Let's say Alice wants to buy 100 million USDC worth of ETH on-chain. An order of this size will be expensive to execute on existing AMMs like Uniswap, which must charge Alice a high price in case she knows something they don't.","_key":"996e765bcf410","_type":"span"}],"_type":"block","style":"normal","_key":"36d8fbc983dc"},{"children":[{"text":"Today, Alice's best option is to manually break her order up into several pieces and execute them over a period of hours, giving the market time to realize she does not have inside information so it can give her a better price.","_key":"30e06a99618c0","_type":"span","marks":[]}],"_type":"block","style":"normal","_key":"3b276a850797","asset":null,"markDefs":[]},{"style":"normal","_key":"2fa36689acf1","asset":null,"markDefs":[],"children":[{"marks":[],"text":"If she sends a few large sub-orders, each will still have significant price impact and will be vulnerable to ","_key":"dc4f7aab8ba70","_type":"span"},{"_type":"span","marks":["em"],"text":"sandwich attacks","_key":"dc4f7aab8ba71"},{"marks":[],"text":" by adversarial traders. On the other hand, if she sends many small sub-orders, she will have to take on all the work and risk of active trading, and will pay high costs in the form of per-transaction gas fees to miners.","_key":"dc4f7aab8ba72","_type":"span"}],"_type":"block"},{"children":[{"_type":"span","marks":[],"text":"The TWAMM resolves this dilemma for Alice by trading on her behalf. It breaks her order into infinitely many infinitely small ","_key":"c20590ec8ee30"},{"_type":"span","marks":["em"],"text":"virtual orders","_key":"c20590ec8ee31"},{"_type":"span","marks":[],"text":" to ensure perfectly smooth execution over time, and, using a special mathematical relationship with its embedded AMM, is able to amortize gas costs across these virtual orders. Because it processes trades ","_key":"c20590ec8ee32"},{"_type":"span","marks":["em"],"text":"in between","_key":"c20590ec8ee33"},{"_type":"span","marks":[],"text":" blocks, it is also less susceptible to sandwich attacks.","_key":"c20590ec8ee34"}],"_type":"block","style":"normal","_key":"0730c1d3f394","markDefs":[],"asset":null}]},{"_type":"richTextBlock","_key":"c981c56ecd78","content":[{"_key":"155dedc076c1","markDefs":[],"children":[{"_type":"span","marks":[],"text":"Market Making Basics","_key":"0f24033f7df30"}],"_type":"block","asset":null,"style":"h2"}]},{"_type":"richTextBlock","_key":"26228bf154d9","content":[{"_type":"block","style":"h3","_key":"4df658761a99","markDefs":[],"children":[{"_type":"span","marks":[],"text":"Market Makers","_key":"d237a804d9180"}],"asset":null},{"_key":"2d259b9ded4c","markDefs":[],"children":[{"_type":"span","marks":[],"text":"Consider a market for two financial assets, say, USDC and ETH. A ","_key":"c33b412102260"},{"_type":"span","marks":["em"],"text":"market maker","_key":"c33b412102261"},{"_type":"span","marks":[],"text":" is a participant in this market who is willing, at any time, to trade either one for the other.","_key":"c33b412102262"}],"_type":"block","asset":null,"style":"normal"},{"_type":"block","style":"normal","_key":"c1185d49660b","asset":null,"markDefs":[],"children":[{"_type":"span","marks":[],"text":"If you have 100 million USDC and want to use it to buy ETH, you probably won't be able to find another individual who wants to do the opposite trade at the exact same time. Instead, you will most likely go to a market populated by one or more market makers and trade with them.","_key":"865d7c5bb6350"}]}]},{"_type":"richTextBlock","_key":"93825172fa41","content":[{"_key":"cf025149d42d","markDefs":[],"children":[{"_type":"span","marks":[],"text":"Adverse Selection","_key":"f17c04571fc80"}],"_type":"block","asset":null,"style":"h3"},{"_type":"block","style":"normal","_key":"7ffacbe0d53b","markDefs":[],"children":[{"_type":"span","marks":[],"text":"Market makers earn a profit from the ","_key":"5fe5abb000160"},{"_type":"span","marks":["em"],"text":"spread","_key":"5fe5abb000161"},{"marks":[],"text":", effectively a fee they charge on each trade. They lose money when prices ","_key":"5fe5abb000162","_type":"span"},{"_type":"span","marks":["em"],"text":"move against","_key":"5fe5abb000163"},{"_key":"5fe5abb000164","_type":"span","marks":[],"text":" them — when they buy an asset whose price then goes down, or sell an asset whose price then goes up."}],"asset":null},{"asset":null,"_type":"block","style":"normal","_key":"9747ad1e2bfc","markDefs":[],"children":[{"text":"Unfortunately for market makers, prices tend to move against them on average. This phenomenon is known as ","_key":"acfc2255daf20","_type":"span","marks":[]},{"marks":["em"],"text":"adverse selection.","_key":"acfc2255daf21","_type":"span"},{"_type":"span","marks":[],"text":" It happens because traders with information about future price movements are more likely to trade against market makers for large size.","_key":"acfc2255daf22"}]},{"_key":"43c5879d5905","asset":null,"markDefs":[],"children":[{"_type":"span","marks":[],"text":"The most dangerous orders are ones that are both ","_key":"320270bdf5850"},{"_type":"span","marks":["em"],"text":"large","_key":"320270bdf5851"},{"_type":"span","marks":[],"text":" and ","_key":"320270bdf5852"},{"text":"urgent","_key":"320270bdf5853","_type":"span","marks":["em"]},{"_key":"320270bdf5854","_type":"span","marks":[],"text":", because those are precisely the type of orders informed traders tend to make. As a result, the most basic market making tactic is to "},{"_type":"span","marks":["em"],"text":"fade","_key":"320270bdf5855"},{"_type":"span","marks":[],"text":" incoming orders, adjusting prices up when a large buy order comes in, and adjusting prices down when a large sell order comes in.","_key":"320270bdf5856"}],"_type":"block","style":"normal"}]},{"_type":"richTextBlock","_key":"ef76bc6122e2","content":[{"style":"h2","_key":"c985b642107d","markDefs":[],"children":[{"_type":"span","marks":[],"text":"Automated Market Makers","_key":"757dcc6308d50"}],"_type":"block","asset":null},{"children":[{"_type":"span","marks":[],"text":"In the past year, ","_key":"c480b78d59720"},{"text":"automated market makers (AMMs)","_key":"c480b78d59721","_type":"span","marks":["em"]},{"_type":"span","marks":[],"text":", led by ","_key":"c480b78d59722"},{"_type":"span","marks":["a86a599babeb"],"text":"Uniswap","_key":"c480b78d59723"},{"_type":"span","marks":[],"text":", have become hugely popular on Ethereum, handling billions of dollars of volume daily. True to their name, AMMs automate much of the market making process.","_key":"c480b78d59724"}],"_type":"block","style":"normal","_key":"6e56e255ab0e","markDefs":[{"href":"https://info.uniswap.org/#/","_key":"a86a599babeb","_type":"link"}],"asset":null}]},{"_type":"richTextBlock","_key":"3a7a63a1cab4","content":[{"asset":null,"_type":"block","style":"h3","_key":"ed26477b844e","markDefs":[],"children":[{"_type":"span","marks":[],"text":"The Constant Product Formula","_key":"de61e29ec2d70"}]},{"children":[{"text":"The ","_key":"41c77f39a2ac0","_type":"span","marks":[]},{"_type":"span","marks":["em"],"text":"constant product formula","_key":"41c77f39a2ac1"},{"_type":"span","marks":[],"text":" is a simple rule that allows anybody to spin up both a new market and a new AMM for a new pair of assets instantaneously.","_key":"41c77f39a2ac2"}],"_type":"block","style":"normal","_key":"10edb9fea8bb","markDefs":[],"asset":null},{"asset":null,"_type":"block","style":"normal","_key":"6efd3887384d","markDefs":[],"children":[{"_type":"span","marks":[],"text":"To create a new Constant Product AMM (CPAMM) between two assets X and Y, a user, called a ","_key":"5540e8bf872e0"},{"text":"liquidity provider","_key":"5540e8bf872e1","_type":"span","marks":["em"]},{"_type":"span","marks":[],"text":", or LP, deposits ","_key":"5540e8bf872e2"},{"_type":"span","marks":["em"],"text":"reserves","_key":"5540e8bf872e3"},{"text":" x and y of those two assets.","_key":"5540e8bf872e4","_type":"span","marks":[]}]},{"children":[{"_type":"span","marks":[],"text":"The ratio of these assets at any given time represents the ","_key":"6be15596ef6b0"},{"_type":"span","marks":["em"],"text":"instantaneous price","_key":"6be15596ef6b1"},{"_type":"span","marks":[],"text":" on the AMM, or the price it will charge for a very small order. For example, if a CPAMM contains 2,000 USDC and 1 ETH in its reserves, its instantaneous price for ETH will be 2,000 USDC.","_key":"6be15596ef6b2"}],"_type":"block","style":"normal","asset":null,"_key":"1f831f13fc83","markDefs":[]},{"markDefs":[],"children":[{"_type":"span","marks":[],"text":"When traders come to trade with the AMM, it decides what price to give them based on the formula **x * y = k, where x and y are the reserve sizes and k is a constant. This means that the ","_key":"c1061f853cdd0"},{"_type":"span","marks":["em"],"text":"product","_key":"c1061f853cdd1"},{"_type":"span","marks":[],"text":" of its reserve sizes stays the same during a trade (ignoring fees).","_key":"c1061f853cdd2"}],"_type":"block","style":"normal","_key":"91ca520e212a","asset":null}]},{"_type":"richTextBlock","_key":"2cf1bd488565","content":[{"_key":"056262807c9d","markDefs":[],"children":[{"_type":"span","marks":[],"text":"Example","_key":"5479733c97990"}],"_type":"block","asset":null,"style":"h4"},{"markDefs":[],"children":[{"_type":"span","marks":[],"text":"Consider an ETH/USDC CPAMM with 2,000 USDC and 1 ETH in the reserves, so that x = 2,000, y = 1, and x * y = k = 2,000. The instantaneous price of this AMM is 2,000 / 1 = 2,000 USDC per ETH.","_key":"664c14da59220"}],"_type":"block","style":"normal","asset":null,"_key":"6bd556f53977"},{"children":[{"_type":"span","marks":[],"text":"If a trader comes and buys 2,000 USDC worth of ETH, that means they are depositing 2,000 USDC into the X reserves, so that we will have x = 2,000 + 2,000 = 4,000.","_key":"8beba5275f560"}],"asset":null,"_type":"block","style":"normal","_key":"38715aa91e21","markDefs":[]},{"style":"normal","_key":"1e7af9bc58da","asset":null,"markDefs":[],"children":[{"_type":"span","marks":[],"text":"Then, since k = 2000, we must have y = k/x = 2000/4000 = 0.5 after the trade. Since y was originally 1, 1 - 0.5 = 0.5 ETH must have gone to the trader.","_key":"64ec10c95ca50"}],"_type":"block"},{"_key":"8b1c7aa11590","markDefs":[],"children":[{"_type":"span","marks":[],"text":"Since the trader bought 0.5 ETH with their 2000 USDC, they paid an average price of 4,000 USDC per ETH. This high price relative to the instantaneous price reflects the large order size relative to the liquidity in the AMM.","_key":"3882f7e832500"}],"_type":"block","style":"normal","asset":null}]},{"_type":"richTextBlock","_key":"91adf09e50b6","content":[{"style":"h4","_key":"325d4826eb7d","markDefs":[],"children":[{"_type":"span","marks":[],"text":"Price Impact and Adverse Selection","_key":"045ce3a9eca30"}],"_type":"block","asset":null},{"_key":"3416ff158e7e","markDefs":[],"children":[{"marks":[],"text":"In the above case, the trader had to pay 4,000 USDC per ETH for their large order when the cost for a small order would have been only 2,000 USDC per ETH. This difference in price is referred to as the ","_key":"bc7255460ca30","_type":"span"},{"_type":"span","marks":["em"],"text":"price impact","_key":"bc7255460ca31"},{"_type":"span","marks":[],"text":" of the order. The larger the incoming order, the greater the price impact.","_key":"bc7255460ca32"}],"_type":"block","style":"normal","asset":null},{"_type":"block","style":"normal","_key":"f4ca088c2716","markDefs":[],"asset":null,"children":[{"marks":[],"text":"This is how the AMM combats adverse selection: large incoming orders are more likely to be informed, and so the AMM makes them pay a high price. It is the automated equivalent of fading an order.","_key":"9f6b2bc521180","_type":"span"}]}]},{"_type":"richTextBlock","_key":"6a224408ded1","content":[{"_key":"223ac5c918c1","asset":null,"markDefs":[],"children":[{"_key":"cfbd00adf5b30","_type":"span","marks":[],"text":"Executing Large Orders on Current AMMs"}],"_type":"block","style":"h2"}]},{"_type":"richTextBlock","_key":"5a76325c7936","content":[{"_type":"block","style":"h3","asset":null,"_key":"0fdeda0f4fc8","markDefs":[],"children":[{"_type":"span","marks":[],"text":"Manual Order Splitting","_key":"60465861f2690"}]},{"_type":"block","asset":null,"style":"normal","_key":"02de80a5bfa9","markDefs":[{"_type":"link","href":"https://www.paradigm.xyz/2021/04/understanding-automated-market-makers-part-1-price-impact/","_key":"3af0e94e3655"}],"children":[{"_type":"span","marks":[],"text":"As we can see, executing a large order on an AMM in a single transaction is expensive by design. ","_key":"3d01e9abdd2f0"},{"_type":"span","marks":["3af0e94e3655"],"text":"This excellent article","_key":"3d01e9abdd2f1"},{"_type":"span","marks":[],"text":" goes into the problem in depth and recommends some solutions.","_key":"3d01e9abdd2f2"}]},{"children":[{"_type":"span","marks":[],"text":"In short, a trader who wishes to execute a large order on an AMM should not do it in a single transaction: they are better off splitting their order into several pieces. This could involve sending orders to several AMMs at once, but these AMMs too will have limited liquidity at any given point in time. The larger the order, the more attractive splitting it up over ","_key":"4192323d8b7d0"},{"_key":"4192323d8b7d1","_type":"span","marks":["em"],"text":"time"},{"text":" becomes.","_key":"4192323d8b7d2","_type":"span","marks":[]}],"_type":"block","asset":null,"style":"normal","_key":"c54f122e8a3a","markDefs":[]},{"children":[{"marks":[],"text":"For example, let's say an investor wants to buy 100 million USDC of ETH on-chain. They don't have any short-term information about the price of ETH, and so don't mind if their order takes some time to execute. In this case, they might break their order into ten chunks of ten million USDC each and execute each chunk one hour apart, limiting the price impact of each part.","_key":"9f9c15769cf90","_type":"span"}],"_type":"block","asset":null,"style":"normal","_key":"6231553d908c","markDefs":[]}]},{"_type":"richTextBlock","_key":"6cd3c5cdd70a","content":[{"markDefs":[],"children":[{"text":"The Sub-Order Size Tradeoff","_key":"4663fcf8b7a50","_type":"span","marks":[]}],"_type":"block","style":"h3","_key":"42c2c20c08c8","asset":null},{"markDefs":[],"children":[{"_type":"span","marks":[],"text":"Obviously, if a very large order is split into only a few pieces, each individual sub-order will still be large, and will incur price impact accordingly. Splitting the order into even smaller pieces helps, but this introduces two new problems of its own.","_key":"d8d442453a150"}],"asset":null,"_type":"block","style":"normal","_key":"1d0cc4e86fd6"},{"markDefs":[],"children":[{"_type":"span","marks":[],"text":"The first problem is ","_key":"e637ab82220d0"},{"_type":"span","marks":["em"],"text":"operational complexity","_key":"e637ab82220d1"},{"_type":"span","marks":[],"text":", meaning increased risk and work. The trader might enter the wrong trade quantity for a given trade, or the wrong direction. Or her computer could crash, preventing her from executing part of the order. Even if everything goes right, the process takes time and effort, distracting attention from more profitable endeavors.","_key":"e637ab82220d2"}],"_type":"block","style":"normal","_key":"6c8a4f864605","asset":null},{"markDefs":[],"children":[{"marks":[],"text":"The second problem is that each trade incurs fixed ","_key":"b91687e226d20","_type":"span"},{"_type":"span","marks":["em"],"text":"transaction costs","_key":"b91687e226d21"},{"_key":"b91687e226d22","_type":"span","marks":[],"text":", such as the "},{"_type":"span","marks":["em"],"text":"gas","_key":"b91687e226d23"},{"_type":"span","marks":[],"text":" paid to Ethereum miners to process the transaction. If the trader splits her order into too many pieces, she can end up spending more money on fees than on actually buying ETH.","_key":"b91687e226d24"}],"_type":"block","style":"normal","_key":"d17294f40d74","asset":null}]},{"_type":"richTextBlock","_key":"0ff5837bc560","content":[{"markDefs":[],"children":[{"_type":"span","marks":[],"text":"Analogy to Traditional Finance","_key":"5e8610102b2f0"}],"_type":"block","style":"h2","_key":"ccd443f1c3b6","asset":null},{"_type":"block","style":"normal","asset":null,"_key":"231d14af15c3","markDefs":[],"children":[{"_key":"d644c21f20e20","_type":"span","marks":[],"text":"In the world of traditional finance, if an investor or institution wanted to buy $100 million dollars of Apple stock, they would not send a $100 million market buy order directly to an exchange. Nor would they send ten such orders for $10 million each. Breaking the order into pieces much smaller than that would be impractical for most without dedicated trading staff and infrastructure."}]},{"children":[{"marks":[],"text":"Instead, they would most likely send their large order to a broker, who would put on an ","_key":"cad9a6f15f2e0","_type":"span"},{"marks":["em","36fb84c9b386"],"text":"algorithmic trade","_key":"cad9a6f15f2e1","_type":"span"},{"text":" for them in exchange for a fee. The broker would execute the trade over a specified period of time, say, eight hours, at a price similar to some benchmark. The broker would have a team specialized in executing such trades safely and cheaply.","_key":"cad9a6f15f2e2","_type":"span","marks":[]}],"_type":"block","style":"normal","asset":null,"_key":"ea1f10ff524c","markDefs":[{"_type":"link","href":"https://en.wikipedia.org/wiki/Algorithmic_trading","_key":"36fb84c9b386"}]}]},{"_type":"richTextBlock","_key":"4ee6aca23156","content":[{"_key":"e5b315d67154","markDefs":[],"children":[{"_type":"span","marks":[],"text":"The TWAP Order","_key":"0d1148311a280"}],"_type":"block","style":"h3","asset":null},{"asset":null,"_type":"block","style":"normal","_key":"02a8e9ebc142","markDefs":[{"href":"https://en.wikipedia.org/wiki/Time-weighted_average_price","_key":"56c2903db9df","_type":"link"}],"children":[{"_type":"span","marks":[],"text":"Perhaps the most basic type of algorithmic trade is the ","_key":"333699b43c220"},{"_type":"span","marks":["56c2903db9df"],"text":"Time-Weighted Average Price","_key":"333699b43c221"},{"_type":"span","marks":[],"text":", or TWAP (pronounced \"tee-whap\") order. A TWAP order to buy $100 million dollars of Apple stock over eight hours would, as the name suggests, get filled at a price close to the time-weighted average price of Apple stock over that period.","_key":"333699b43c222"}]},{"markDefs":[],"children":[{"_type":"span","marks":[],"text":"For example, if Apple stock spent four hours priced at $100 and four hours priced at $120 over the time period, the time-weighted average price would be ($100 * 4 + $120 * 4)/8 = $110, and the broker would execute the TWAP order for near that price.","_key":"0879946a6fbe0"}],"_type":"block","style":"normal","_key":"51f4c8a4b579","asset":null},{"style":"normal","_key":"65841b86f432","markDefs":[],"asset":null,"children":[{"_key":"3d70cf5add010","_type":"span","marks":[],"text":"Details vary, but the broker would most likely execute this trade by splitting it into many small pieces throughout the day and sending them to the market. Buying $100 million of Apple stock over eight hours is equivalent to buying around $350 of Apple stock every 100 milliseconds, and we might expect the broker to do more or less that."}],"_type":"block"},{"style":"normal","_key":"fd939cc43053","asset":null,"markDefs":[],"children":[{"_type":"span","marks":[],"text":"The broker has the infrastructure to reduce or eliminate the operational complexity of so many small trades, and, as they have a direct connection to the market, will likely not have to pay much in transaction costs.","_key":"e82a98dd543a0"}],"_type":"block"}]},{"_type":"richTextBlock","_key":"b9668751aeb7","content":[{"children":[{"marks":[],"text":"The Time-Weighted Average Market Maker","_key":"014d50e17ddb0","_type":"span"}],"_type":"block","asset":null,"style":"h2","_key":"085819af467d","markDefs":[]},{"markDefs":[],"asset":null,"children":[{"marks":[],"text":"The Time-Weighted Average Market Maker (TWAMM) provides the on-chain equivalent of the TWAP order. The TWAMM has specialized logic for order splitting and a direct connection to an embedded exchange, providing smooth execution for low gas cost. Arbitrageurs keep prices on the TWAMM's embedded exchange in line with market prices, ensuring execution near the time-weighted average price of the asset.","_key":"1d8170b18c160","_type":"span"}],"_type":"block","style":"normal","_key":"630098fb7bff"}]},{"_type":"richTextBlock","_key":"6c546c70ebd3","content":[{"_key":"c056b6512492","markDefs":[],"children":[{"_type":"span","marks":[],"text":"Overview","_key":"30117a9cf9370"}],"asset":null,"_type":"block","style":"h3"},{"_type":"block","style":"normal","asset":null,"_key":"aac3256b3dbd","markDefs":[],"children":[{"_key":"1473d82680b10","_type":"span","marks":[],"text":"Each TWAMM instance facilitates trading between a particular pair of assets, such as ETH and USDC."}]},{"style":"normal","_key":"6a3c726c1ef0","markDefs":[],"children":[{"_type":"span","marks":[],"text":"The TWAMM contains an ","_key":"12c1760bdc3a0"},{"text":"embedded AMM","_key":"12c1760bdc3a1","_type":"span","marks":["em"]},{"_type":"span","marks":[],"text":", a standard constant-product market maker for those two assets. Anyone may trade with this embedded AMM at any time, just as if it were a normal AMM.","_key":"12c1760bdc3a2"}],"_type":"block","asset":null},{"children":[{"_type":"span","marks":[],"text":"Traders can submit ","_key":"85b8462c77de0"},{"_type":"span","marks":["em"],"text":"long-term orders","_key":"85b8462c77de1"},{"_key":"85b8462c77de2","_type":"span","marks":[],"text":" to the TWAMM, which are orders to sell a fixed amount of one of the assets over a fixed number of blocks — say, an order to sell 100 ETH over the next 2,000 blocks."}],"_type":"block","style":"normal","_key":"6b8d0169dec3","asset":null,"markDefs":[]},{"_type":"block","style":"normal","_key":"e9c866bd1d34","markDefs":[],"asset":null,"children":[{"marks":[],"text":"The TWAMM breaks these long-term orders into infinitely many infinitely small ","_key":"8ac33ae9eb6e0","_type":"span"},{"_type":"span","marks":["em"],"text":"virtual sub-orders","_key":"8ac33ae9eb6e1"},{"text":", which trade against the embedded AMM at an even rate over time. Processing transactions for each of these virtual sub-orders individually would cost infinite gas, but a closed-form mathematical formula allows us to calculate their cumulative effect only when needed.","_key":"8ac33ae9eb6e2","_type":"span","marks":[]}]},{"children":[{"marks":[],"text":"The execution of long-term orders will push the embedded AMM's price away from prices on other markets over time. When this happens, ","_key":"a7351e619bd60","_type":"span"},{"_type":"span","marks":["em"],"text":"arbitrageurs","_key":"a7351e619bd61"},{"_type":"span","marks":[],"text":" will trade against the embedded AMM's price to bring it back in line, ensuring good execution for long-term orders.","_key":"a7351e619bd62"}],"_type":"block","style":"normal","_key":"c34b8e02f194","asset":null,"markDefs":[]},{"markDefs":[],"children":[{"text":"For example, if long-term sells have made ETH cheaper on the embedded AMM than it is on a particular centralized exchange, arbitrageurs will buy ETH from the embedded AMM, bringing its price back up, and sell it on the centralized exchange for a profit.","_key":"47e5960c38140","_type":"span","marks":[]}],"_type":"block","style":"normal","_key":"42458bc83215","asset":null}]},{"_type":"richTextBlock","_key":"9f6774cbc55b","content":[{"markDefs":[],"children":[{"_type":"span","marks":[],"text":"Ethereum Refresher","_key":"95b92e785f170"}],"_type":"block","asset":null,"style":"h3","_key":"78164e405651"}]},{"_type":"richTextBlock","_key":"46bf8f45a711","content":[{"_key":"1c9cb6292216","markDefs":[],"children":[{"marks":[],"text":"Blocks","_key":"74a118ba80f10","_type":"span"}],"_type":"block","style":"h4","asset":null},{"_key":"6e4259cc8ea0","markDefs":[],"asset":null,"children":[{"marks":[],"text":"Ethereum bundles transactions into sequential groups called ","_key":"35fc8a33a4320","_type":"span"},{"_type":"span","marks":["em"],"text":"blocks","_key":"35fc8a33a4321"},{"_type":"span","marks":[],"text":", approximately one every 13 seconds. For the purposes of this post, we will number each block: block 1 is followed by block 2, which is followed by block 3, and so on.","_key":"35fc8a33a4322"}],"_type":"block","style":"normal"}]},{"_type":"richTextBlock","_key":"ecb414e86a81","content":[{"_type":"block","style":"h4","asset":null,"_key":"421d0c3143fe","markDefs":[],"children":[{"marks":[],"text":"Miners","_key":"5cbc19ed63c60","_type":"span"}]},{"_type":"block","style":"normal","_key":"9119170a5d86","markDefs":[],"asset":null,"children":[{"_key":"bf0a8393e5840","_type":"span","marks":[],"text":"A distributed groups of "},{"_key":"bf0a8393e5841","_type":"span","marks":["em"],"text":"miners"},{"_type":"span","marks":[],"text":" competes to process each block. Anybody with an internet connection can become a miner. This means that programs like AMMs that run on Ethereum cannot keep any secrets: everybody has to be able to calculate exactly what they will do given their inputs.","_key":"bf0a8393e5842"}]}]},{"_type":"richTextBlock","_key":"9d550735c8cb","content":[{"children":[{"_type":"span","marks":[],"text":"Gas","_key":"7ca7dd42fc3e0"}],"_type":"block","style":"h4","_key":"2afb7c9e22c4","markDefs":[],"asset":null},{"_key":"584b56fa9764","markDefs":[],"children":[{"_type":"span","marks":[],"text":"Computation on Ethereum is a scarce resource, and so users must pay miners for it in the form of ","_key":"2e58f24590830"},{"_type":"span","marks":["em"],"text":"gas","_key":"2e58f24590831"},{"marks":[],"text":". The more computation involved in a given transaction, the more gas it will consume. This gas cost is paid entirely by the person submitting the transaction.","_key":"2e58f24590832","_type":"span"}],"asset":null,"_type":"block","style":"normal"}]},{"_type":"richTextBlock","_key":"daa24e0c05e9","content":[{"_type":"block","style":"h3","_key":"1d359704c8d6","markDefs":[],"children":[{"text":"Basic Design","_key":"8030f2e0f5110","_type":"span","marks":[]}],"asset":null}]},{"_type":"richTextBlock","_key":"b95feee9aefc","content":[{"children":[{"text":"Long-Term Orders","_key":"4995ca98699d0","_type":"span","marks":[]}],"_type":"block","style":"h4","_key":"4e10484d320f","markDefs":[],"asset":null},{"_type":"block","style":"normal","_key":"10982f85c652","markDefs":[],"children":[{"text":"Alice wants to buy 100 million USDC worth of ETH over the next 8 hours, or about 2,000 blocks. She enters a long-term order into the TWAMM to buy 100 million USDC worth of ETH over 2,000 blocks, or 50,000 USDC per block.","_key":"c7f46c1a85010","_type":"span","marks":[]}],"asset":null},{"markDefs":[],"children":[{"_type":"span","marks":[],"text":"As mentioned above, we don't know in advance which miners will process future transactions on the TWAMM. This means Alice's order must be visible to everyone, introducing information leakage concerns which we discuss below.","_key":"2c7b2174301b0"}],"asset":null,"_type":"block","style":"normal","_key":"5f9dfdbf0c7a"}]},{"_type":"richTextBlock","_key":"51f679d28df0","content":[{"children":[{"_type":"span","marks":[],"text":"Order Pools","_key":"8cacb30d9ac90"}],"asset":null,"_type":"block","style":"h4","_key":"e72d266da5a3","markDefs":[]},{"_key":"c156f33624cf","markDefs":[],"children":[{"_key":"484d164e34d80","_type":"span","marks":[],"text":"Bob wants to sell 500 ETH for USDC over the next 5,000 blocks, or 0.1 ETH per block."}],"_type":"block","style":"normal","asset":null},{"markDefs":[],"children":[{"_type":"span","marks":[],"text":"Charlie wants to sell 100 ETH for USDC over the next 2,000 blocks, or 0.05 ETH per block.","_key":"8a825533b6530"}],"asset":null,"_type":"block","style":"normal","_key":"e7f6ce6150f6"},{"asset":null,"style":"normal","_key":"ab2aede2da81","markDefs":[],"children":[{"marks":[],"text":"Until Charlie's order expires in 2,000 blocks, Bob's and Charlie's orders will be grouped together in a ","_key":"95fbc81e872a0","_type":"span"},{"_type":"span","marks":["em"],"text":"pool","_key":"95fbc81e872a1"},{"text":".","_key":"95fbc81e872a2","_type":"span","marks":[]}],"_type":"block"},{"_type":"block","asset":null,"style":"normal","_key":"4fda30bf95b0","markDefs":[],"children":[{"_key":"f950a1b76df30","_type":"span","marks":[],"text":"This ETH selling pool will sell ETH at a rate of 0.15 ETH per block for the next 2,000 blocks. Bob will get 0.1/0.15 ≈ 66% of the USDC the pool earns in this way. Charlie will get 0.05/0.15 ≈ 33% of the USDC the pool earns."}]}]},{"_type":"richTextBlock","_key":"12aa3e0f7db3","content":[{"markDefs":[],"children":[{"_type":"span","marks":[],"text":"Virtual Orders","_key":"4f167532303c0"}],"_type":"block","style":"h4","asset":null,"_key":"9d85ca84f945"},{"style":"normal","_key":"aa2043e46046","markDefs":[],"asset":null,"children":[{"marks":[],"text":"Every block for the next 2,000 blocks, the TWAMM has to buy 50,000 USDC worth of ETH on behalf of Alice and sell 0.15 ETH for USDC on behalf of the ETH selling pool.","_key":"8734c8787af10","_type":"span"}],"_type":"block"},{"asset":null,"style":"normal","_key":"e5f1e8de3d14","markDefs":[],"children":[{"marks":[],"text":"We can imagine that the TWAMM splits each of these two sub-orders into trillions of tiny sub-sub-orders we call ","_key":"c22c52196e7c0","_type":"span"},{"_type":"span","marks":["em"],"text":"virtual orders","_key":"c22c52196e7c1"},{"_type":"span","marks":[],"text":" (in fact, it breaks them into an infinite number of infinitesimal virtual orders).","_key":"c22c52196e7c2"}],"_type":"block"},{"children":[{"_type":"span","marks":[],"text":"The TWAMM then takes turns executing these virtual orders against its embedded AMM: first one of Alice's virtual orders, then one of the ETH selling pool's, then another of Alice's, and so on.","_key":"ad6589ff8ab60"}],"_type":"block","style":"normal","asset":null,"_key":"6264b7666109","markDefs":[]}]},{"_type":"richTextBlock","_key":"5b7499a04f20","content":[{"asset":null,"style":"h4","_key":"b8a7975a6f3b","markDefs":[],"children":[{"_type":"span","marks":[],"text":"Arbitrage","_key":"43c2b62a71d20"}],"_type":"block"},{"style":"normal","_key":"393fe3e4b21a","markDefs":[],"asset":null,"children":[{"_key":"d0596a35fa310","_type":"span","marks":[],"text":"Because Alice is buying much more ETH than the ETH pool is selling, the price of ETH on the embedded AMM will go up each block."}],"_type":"block"},{"children":[{"_key":"eac6c6dcd0cb0","_type":"span","marks":[],"text":"When this price is sufficiently high relative to the prices for ETH elsewhere, "},{"_type":"span","marks":["em"],"text":"arbitrageurs","_key":"eac6c6dcd0cb1"},{"text":" will buy that cheaper ETH on other exchanges and sell it on the embedded AMM, bringing its prices back in line with the market average and ensuring good execution for Alice.","_key":"eac6c6dcd0cb2","_type":"span","marks":[]}],"_type":"block","asset":null,"style":"normal","_key":"a06636fb6c27","markDefs":[]}]},{"_type":"richTextBlock","_key":"a71ceb001926","content":[{"markDefs":[],"children":[{"_type":"span","marks":[],"text":"Order Expiry","_key":"da56de4f2a8e0"}],"_type":"block","style":"h4","asset":null,"_key":"c5a3db008f98"},{"style":"normal","asset":null,"_key":"e65eacaa6714","markDefs":[],"children":[{"text":"After block 2,000, Alice's order will be completely filled, as will Charlie's. Bob's order to sell ETH is still in effect for the next 3,000 blocks, and the TWAMM will continue to execute it at a rate of 0.1 ETH per block during that period.","_key":"ad47422a696b0","_type":"span","marks":[]}],"_type":"block"},{"asset":null,"_key":"df4655e3ef2b","markDefs":[],"children":[{"_key":"541164c8da4a0","_type":"span","marks":[],"text":"Barring any outside activity, this will push the price of ETH down on the embedded AMM over time, this time prompting arbitrageurs to bring prices back "},{"_type":"span","marks":["em"],"text":"up","_key":"541164c8da4a1"},{"_type":"span","marks":[],"text":" once they get sufficiently out of line.","_key":"541164c8da4a2"}],"_type":"block","style":"normal"}]},{"_type":"richTextBlock","_key":"96cf7254dd05","content":[{"_key":"006bfbb586e6","markDefs":[],"children":[{"_type":"span","marks":[],"text":"Economics","_key":"b8e85b5d3ef20"}],"_type":"block","style":"h4","asset":null},{"style":"normal","_key":"c93f83c79c03","markDefs":[],"children":[{"text":"Because none of Alice, Bob, or Charlie are in a hurry to execute their orders, other market participants can infer that their orders represent less adverse selection than they otherwise would, and can provide them with low-price-impact execution.","_key":"72c04b6b77160","_type":"span","marks":[]}],"_type":"block","asset":null},{"_type":"block","style":"normal","_key":"7315337c1634","asset":null,"markDefs":[],"children":[{"_type":"span","marks":[],"text":"Because the TWAMM will then be the best place for people like Alice, Bob, and Charlie to trade, LPs on the TWAMM's embedded AMM are likely to interact with a high volume of uninformed flow like theirs. This helps LPs earn money from fees while reducing their relative exposure to adverse selection.","_key":"4023fa424d8f0"}]}]},{"_type":"richTextBlock","_key":"f0b1f88fe054","content":[{"asset":null,"_type":"block","style":"h3","_key":"a2cf99104ee3","markDefs":[],"children":[{"marks":[],"text":"Infinitesimal Virtual Orders","_key":"b876a3960f820","_type":"span"}]},{"markDefs":[],"children":[{"text":"We mentioned above that the TWAMM splits long-term orders into infinitely many infinitely small sub-orders. There are two reasons to do this: smoothness and efficiency.","_key":"708db21cc39c0","_type":"span","marks":[]}],"_type":"block","style":"normal","_key":"3ce00e574be7","asset":null}]},{"_type":"richTextBlock","_key":"86cd0fd1b0d4","content":[{"_key":"8afa5f4e251d","asset":null,"markDefs":[],"children":[{"_key":"2cb8860b09e90","_type":"span","marks":[],"text":"Smoothness"}],"_type":"block","style":"h4"},{"asset":null,"markDefs":[],"children":[{"_type":"span","marks":[],"text":"The primary goal of the TWAMM is to execute its long-term orders smoothly over time so that they are executed for close to the prevailing time-weighted average price.","_key":"4c8c2f1207a20"}],"_type":"block","style":"normal","_key":"8999fe0ceac9"},{"_key":"9c4bf03f6e69","markDefs":[],"children":[{"_type":"span","marks":[],"text":"As we decrease the size of the virtual trades, price movement on the AMM becomes less and less jagged.","_key":"f366208ca68e0"}],"_type":"block","asset":null,"style":"normal"},{"children":[{"_type":"span","marks":[],"text":"In the limit, with infinitely many infinitely small trades, price movement is perfectly smooth as virtual trades are executed.","_key":"d2d36a873a9b0"}],"asset":null,"_type":"block","style":"normal","_key":"2f4ce4747969","markDefs":[]},{"markDefs":[],"asset":null,"children":[{"text":"","_key":"28a0890d103a0","_type":"span","marks":[]}],"_type":"block","style":"normal","_key":"b7076d7a7584"},{"_key":"b8fc8a7c4514","asset":{"url":"https://cdn.sanity.io/images/dgybcd83/production/6a302398718b494192057f12b05f04d1e013bc1c-1024x769.png","mimeType":"image/png","sha1hash":"6a302398718b494192057f12b05f04d1e013bc1c","path":"images/dgybcd83/production/6a302398718b494192057f12b05f04d1e013bc1c-1024x769.png","size":111214,"metadata":{"dimensions":{"height":769,"_type":"sanity.imageDimensions","width":1024,"aspectRatio":1.3315994798439532},"isOpaque":true,"blurHash":"V2S?DV~WIU~qIU_NM{D*jE-o00Dh%2%Mtm={M|tlV@%M","_type":"sanity.imageMetadata","palette":{"dominant":{"foreground":"#000","title":"#000","population":0.02,"background":"#f1c9c5","_type":"sanity.imagePaletteSwatch"},"_type":"sanity.imagePalette","darkMuted":{"background":"#707070","_type":"sanity.imagePaletteSwatch","foreground":"#fff","title":"#fff","population":0.02},"muted":{"background":"#7c7c7c","_type":"sanity.imagePaletteSwatch","foreground":"#fff","title":"#fff","population":0.02},"lightVibrant":{"population":0.02,"background":"#f1c9c5","_type":"sanity.imagePaletteSwatch","foreground":"#000","title":"#000"},"darkVibrant":{"background":"#6a2119","_type":"sanity.imagePaletteSwatch","foreground":"#fff","title":"#fff","population":0},"lightMuted":{"foreground":"#000","title":"#fff","population":0.02,"background":"#d0bcb3","_type":"sanity.imagePaletteSwatch"},"vibrant":{"foreground":"#fff","title":"#fff","population":0,"background":"#cd3f31","_type":"sanity.imagePaletteSwatch"}},"hasAlpha":false,"lqip":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAABX0lEQVQokY2TiY7jMAxD8/8/ugWaZqZ1bYnU0YXsOTHHLpEEiKOXULSyqWprbd/3P1P7vj+/6mnqOI7L5XIcx1psramqkmPItuDLvp9Op/P53HsHwM/6uGJm5qF0Ed0AiEjvvbXWeyeZvyoyzRPmChRM0t1jKjMfPyvzYZH0MHcA23LyO/OmeCHD3aDT9n/C03CRER7Ogu/3++rzW5uPjLrO0yJo4e7pDPsnHJ6OKg03MyVBOMUpRlWVTUS+sZ2ZbkFxDNdODBERHcAwdIOwPixfAsusloyOYdqteIEOVSE1TNMR5d0B/QgXF04jDOUtpuGqq5ry/whbKUTE61aRWe2ZG5xwQxgy6o2RL3uTEYUVufZswjVupFMNFUPxddDLfdILji9xvsNQhQzqqCRUUfcUcCiGUlF9rfl7G0QzE5Fttl71BGaEC0Yf43q9PV9v19ttjLH+Cq0nNc6q2nv/Cz0pcPxP5ikrAAAAAElFTkSuQmCC"},"_type":"sanity.imageAsset","assetId":"6a302398718b494192057f12b05f04d1e013bc1c","_id":"image-6a302398718b494192057f12b05f04d1e013bc1c-1024x769-png","originalFilename":"amm_eth-1-1024x769.png","_createdAt":"2024-03-27T20:49:18Z","_updatedAt":"2024-03-27T20:49:18Z","extension":"png","uploadId":"cHFYopvcGbm48R5nRJkNbRutBP4oxfVl","_rev":"JZ53jc7OhBIqTkyaondFM4"},"_type":"imageAlt"},{"_key":"5d21c2b545e4","asset":null,"markDefs":[],"children":[{"text":"See: https://github.com/para-dave/twamm/blob/master/splitting_exploration.ipynb","_key":"c53d3a3a98620","_type":"span","marks":["em"]}],"_type":"block","style":"normal"},{"_key":"0c06ae64e17f","markDefs":[],"children":[{"_type":"span","marks":[],"text":"","_key":"7fc48ab8c676"}],"_type":"block","style":"normal","asset":null}]},{"_type":"richTextBlock","_key":"7c087537eda6","content":[{"_type":"block","style":"h4","_key":"d759e0ce27fc","markDefs":[],"asset":null,"children":[{"_type":"span","marks":[],"text":"Efficiency","_key":"d5715ba52ddc0"}]},{"style":"normal","_key":"c56c76854786","markDefs":[],"asset":null,"children":[{"_type":"span","marks":[],"text":"Because the TWAMM is designed to be used on Ethereum, explicitly calculating transactions for multiple virtual trades per block would be prohibitively expensive. However, when we have infinitely many infinitesimal trades, we can compute the outcome for traders in a single computation, no matter how many blocks it has been since we last checked.","_key":"809da0c914170"}],"_type":"block"}]},{"_type":"richTextBlock","_key":"fce7811d4333","content":[{"markDefs":[],"children":[{"marks":[],"text":"Efficiency","_key":"c5174b245d0d0","_type":"span"}],"_type":"block","style":"h4","_key":"77fded8412a4","asset":null},{"style":"normal","_key":"3b7cf5a0b92b","markDefs":[],"children":[{"marks":[],"text":"Because the TWAMM is designed to be used on Ethereum, explicitly calculating transactions for multiple virtual trades per block would be prohibitively expensive. However, when we have infinitely many infinitesimal trades, we can compute the outcome for traders in a single computation, no matter how many blocks it has been since we last checked.","_key":"89c0ea70a4970","_type":"span"}],"_type":"block","asset":null},{"asset":null,"_key":"2d7eea456959","markDefs":[],"children":[{"text":"\n","_key":"04d55025ba6f0","_type":"span","marks":[]}],"_type":"block","style":"normal"}]},{"_type":"richTextBlock","_key":"f2c21734028c","content":[{"markDefs":[],"children":[{"text":"Implementation","_key":"fc2280b522e70","_type":"span","marks":[]}],"_type":"block","style":"h2","_key":"90ef77622392","asset":null}]},{"_type":"richTextBlock","_key":"4f238ed5aa56","content":[{"_type":"block","style":"h3","_key":"a8ac9bed855f","markDefs":[],"children":[{"_type":"span","marks":[],"text":"Lazy Evaluation","_key":"132e78481f390"}],"asset":null},{"markDefs":[],"children":[{"text":"The TWAMM treats virtual sub-orders as if they take place in the space ","_key":"92fb9cc60ca00","_type":"span","marks":[]},{"_type":"span","marks":["em"],"text":"between","_key":"92fb9cc60ca01"},{"_type":"span","marks":[],"text":" blocks, which is important to avoid sandwich attacks.","_key":"92fb9cc60ca02"}],"_type":"block","style":"normal","_key":"55a2d94f03ab","asset":null},{"children":[{"_key":"3ce90b357cf10","_type":"span","marks":[],"text":"To achieve this in a gas-efficient manner, the TWAMM uses "},{"_key":"3ce90b357cf11","_type":"span","marks":["em"],"text":"lazy evaluation"},{"marks":[],"text":", computing the effect of virtual trades only when it is necessary to determine the outcome of an interaction.","_key":"3ce90b357cf12","_type":"span"}],"_type":"block","style":"normal","_key":"a802a9402db0","markDefs":[],"asset":null},{"_type":"block","style":"normal","_key":"1571cf818a36","asset":null,"markDefs":[],"children":[{"_type":"span","marks":[],"text":"Every time a user interacts with the TWAMM (for example, by trading with the embedded AMM or by adding a new long-term order), the TWAMM retroactively calculates the effect of all the virtual trades that took place since the last interaction.","_key":"54da6e79bc520"}]},{"_type":"block","style":"normal","_key":"208c25dd96f0","asset":null,"markDefs":[],"children":[{"_type":"span","marks":[],"text":"Because these virtual trades are interacting only with the TWAMM's embedded AMM, the behavior of the TWAMM is completely deterministic between external interactions. Even if the TWAMM goes one million blocks between external interactions, the next time somebody interacts with it, it will be able to accurately calculate the results of all of the intervening virtual trades.","_key":"7981dfb509030"}]},{"children":[{"_type":"span","marks":[],"text":"Front-ends plugged into the TWAMM will be able to account for virtual trades that have not yet been represented on-chain by keeping track of the current block number and doing the TWAMM calculation themselves.","_key":"8c330f82444a0"}],"_type":"block","style":"normal","_key":"f44b30ce0e68","asset":null,"markDefs":[]}]},{"_type":"richTextBlock","_key":"87b87e837dfc","content":[{"_key":"2023a54839f9","asset":null,"markDefs":[],"children":[{"_type":"span","marks":[],"text":"Gas Optimizations","_key":"e76d710d5f190"}],"_type":"block","style":"h3"}]},{"_type":"richTextBlock","_key":"2c445a35e64a","content":[{"children":[{"_key":"c30bbe097c070","_type":"span","marks":[],"text":"Pooling Orders"}],"_type":"block","asset":null,"style":"h4","_key":"d9bd650d8b4d","markDefs":[]},{"_key":"91c659d9ddd2","markDefs":[{"_type":"link","href":"https://www.paradigm.xyz/2021/05/liquidity-mining-on-uniswap-v3/","_key":"9e5cab6165e8"}],"children":[{"marks":[],"text":"As demonstrated in the example, when we have multiple long-term orders in the same direction (i.e. selling ETH for USDC), we pool them together before splitting them into virtual orders. The TWAMM can then track balances using a version of the ","_key":"29200394eb6b0","_type":"span"},{"_type":"span","marks":["9e5cab6165e8"],"text":"billion-dollar algorithm","_key":"29200394eb6b1"},{"_type":"span","marks":[],"text":" used to track LP rewards in protocols like Compound and Uniswap.","_key":"29200394eb6b2"}],"asset":null,"_type":"block","style":"normal"},{"children":[{"text":"Technically speaking, there are always two long-term order pools per TWAMM, one for each asset: for example, the pool selling USDC and the pool selling ETH. It just might be that one or both of these pools is empty at any given time.","_key":"c44ebf67a23e0","_type":"span","marks":[]}],"_type":"block","asset":null,"style":"normal","_key":"2c3e14b9471b","markDefs":[]}]},{"_type":"richTextBlock","_key":"9f36d55ed528","content":[{"_key":"29cba9d7d204","markDefs":[],"children":[{"marks":[],"text":"Long-Term Order Expiration","_key":"9b9a825fd67e0","_type":"span"}],"_type":"block","style":"h4","asset":null},{"_key":"b31d97dec434","markDefs":[],"children":[{"marks":[],"text":"One complication arises when using order pooling in conjunction with lazy evaluation.","_key":"6496f39fdb5e0","_type":"span"}],"_type":"block","style":"normal","asset":null},{"_type":"block","style":"normal","_key":"13330ec36ddf","markDefs":[],"children":[{"text":"Imagine Bob places an order to sell 100 ETH over the next 100 blocks, and Charlie places an order to sell 200 ETH over the next 200 blocks. Both orders are selling at a rate of 1 ETH per block.","_key":"92afd65c6b990","_type":"span","marks":[]}],"asset":null},{"_type":"block","style":"normal","_key":"1335db8a5a88","asset":null,"markDefs":[],"children":[{"_type":"span","marks":[],"text":"Suppose nobody interacts with the TWAMM for the next 150 blocks, at which point a new external interaction occurs. For the first 100 blocks after Bob and Charlie placed their orders, their orders were pooled into a common order selling 2 ETH per block. However, for the 50 blocks after that, Charlie's order was on its own, selling only 1 ETH per block.","_key":"c8a53f47a56d0"}]},{"_type":"block","asset":null,"style":"normal","_key":"fabbbd80fc56","markDefs":[],"children":[{"_type":"span","marks":[],"text":"That means we have to do two separate trade calculations in order to find out what happened: one calculation for the results of the first 100 blocks, and one calculation for the final 50 blocks. In the worst case, if there had been orders expiring every block for the past 150 blocks, this would mean the TWAMM would have to process one trade per block, ruining gas efficiency.","_key":"7576098653f60"}]},{"markDefs":[],"children":[{"_type":"span","marks":[],"text":"The simplest workaround for this is to limit the number of blocks eligible for order expiry: for example, the TWAMM could specify that orders are only eligible to expire every 250 blocks, or roughly once per hour.","_key":"8acb87d0a5c80"}],"_type":"block","style":"normal","_key":"e8f656c85838","asset":null}]},{"_type":"richTextBlock","_key":"342eb3376a93","content":[{"_type":"block","style":"h4","_key":"74b91b5b2645","markDefs":[],"children":[{"_key":"0ed881909e650","_type":"span","marks":[],"text":"Canceling Long-Term Orders"}],"asset":null},{"_type":"block","style":"normal","_key":"ddb2d0b54918","markDefs":[],"children":[{"text":"Users can cancel long-term orders at any time. In practice, this allows users to select the cancelation time for their order down to the block. This does not increase the gas burden for the system since the user who wants to cancel pays their own gas.","_key":"a1d6274dc2650","_type":"span","marks":[]}],"asset":null}]},{"_type":"richTextBlock","_key":"5308250827ea","content":[{"children":[{"_key":"9059c31b5d280","_type":"span","marks":[],"text":"Virtual Trade Math"}],"_type":"block","style":"h3","_key":"293d2d21de9b","markDefs":[],"asset":null}]},{"_type":"richTextBlock","_key":"1f2037b70d66","content":[{"_key":"b076f46f4d0f","markDefs":[],"children":[{"_key":"d3d29a84f4590","_type":"span","marks":[],"text":"Definitions"}],"_type":"block","style":"h4","asset":null},{"style":"normal","_key":"b8352b9a3168","markDefs":[],"children":[{"_type":"span","marks":[],"text":"Assume it has been ","_key":"73b8ffd96de60"},{"_type":"span","marks":["em"],"text":"t","_key":"73b8ffd96de61"},{"_type":"span","marks":[],"text":" blocks since the TWAMM last executed any virtual trades.","_key":"73b8ffd96de62"}],"_type":"block","asset":null},{"_type":"block","asset":null,"style":"normal","_key":"178f43c275cf","markDefs":[{"_type":"math","math":{"_type":"latex","body":"x_{rate}"},"_key":"d1997a959b13"},{"math":{"body":"y_{rate}","_type":"latex"},"_key":"8e50550dc69f","_type":"math"}],"children":[{"text":"For the sake of simplicity, assume that no long-term orders have expired, so that the pool selling X was selling ","_key":"daa2ea5268ef0","_type":"span","marks":[]},{"marks":["d1997a959b13"],"text":"$_$","_key":"96f728d09d4c","_type":"span"},{"_type":"span","marks":[],"text":" per block over the whole time period and the pool selling Y was selling ","_key":"a6eca332c1a5"},{"_type":"span","marks":["8e50550dc69f"],"text":"$_$","_key":"83098a6b2327"},{"_type":"span","marks":[],"text":" per block over the whole time period.","_key":"624accdbbb7b"}]},{"asset":null,"style":"normal","_key":"2df7caf5e43f","markDefs":[{"_type":"math","math":{"_type":"latex","body":"tx_{rate} = x_{in}"},"_key":"8d2546fc8d52"},{"_type":"math","math":{"_type":"latex","body":"ty_{rate}=y_{in}"},"_key":"02a5fe1d6bb8"}],"children":[{"_key":"cf19c9cec54c0","_type":"span","marks":[],"text":"Then the total amount of X sold over the period was "},{"marks":["8d2546fc8d52"],"text":"$_$","_key":"3512763a23b9","_type":"span"},{"marks":[],"text":" and the total amount of Y sold over the period was ","_key":"5c8f1bf9d41c","_type":"span"},{"_type":"span","marks":["02a5fe1d6bb8"],"text":"$_$","_key":"3c731a388723"},{"_type":"span","marks":[],"text":".","_key":"dcfd105cb9a9"}],"_type":"block"},{"asset":null,"markDefs":[{"_type":"math","math":{"_type":"latex","body":"x_{ammStart}"},"_key":"7d965f9ccd35"},{"_type":"math","math":{"_type":"latex","body":"y_{ammStart}"},"_key":"b38b9e7bd4e9"}],"children":[{"_type":"span","marks":[],"text":"Let's denote the embedded AMM reserves at the beginning of the time period as ","_key":"bdee9b592ca00"},{"text":"$_$","_key":"469d6c0d49a0","_type":"span","marks":["7d965f9ccd35"]},{"text":" and ","_key":"7c3485fa064a","_type":"span","marks":[]},{"_type":"span","marks":["b38b9e7bd4e9"],"text":"$_$","_key":"fb7bf88dac9d"},{"_type":"span","marks":[],"text":", respectively.","_key":"323a057f7c1e"}],"_type":"block","style":"normal","_key":"320578b5ab5a"}]},{"_type":"richTextBlock","_key":"8d9db9a7bf5f","content":[{"style":"h4","_key":"e1038e4b2294","markDefs":[],"children":[{"_type":"span","marks":[],"text":"Formulas","_key":"48833d4548220"}],"_type":"block","asset":null},{"_key":"9bf6832717ef","markDefs":[],"children":[{"_type":"span","marks":[],"text":"After all virtual trades are processed the embedded AMM will have X reserves of","_key":"4d22328f99230"}],"_type":"block","asset":null,"style":"normal"}]},{"_type":"mathBlock","_key":"60f791f44700","content":"x_{ammEnd} = \\sqrt{\\frac{kx_{in}}{y_{in}}}\\frac{e^{2\\sqrt{\\frac{x_{in}y_{in}}{k}}}+c}{e^{2\\sqrt{\\frac{x_{in}y_{in}}{k}}}-c}"},{"_type":"richTextBlock","_key":"c0e09d486014","content":[{"children":[{"_type":"span","marks":[],"text":"where","_key":"0c5298ec5eeb0"}],"_type":"block","style":"normal","_key":"a31bfb3eb691","asset":null,"markDefs":[]}]},{"_type":"mathBlock","_key":"23419384a0d1","content":"c = \\frac{\\sqrt{x_{ammStart}y_{in}}-\\sqrt{y_{ammStart}x_{in}}}{\\sqrt{x_{ammStart}y_{in}}+\\sqrt{y_{ammStart}x_{in}}}"},{"_type":"richTextBlock","_key":"4bf917e66e9a","content":[{"asset":null,"_type":"block","style":"normal","_key":"a491f561b496","markDefs":[],"children":[{"_type":"span","marks":[],"text":"From the constant product formula, we know:","_key":"0907a9c7c2b50"}]}]},{"_type":"mathBlock","_key":"7acfad255af0","content":"y_{ammEnd}=\\frac{x_{ammStart}y_{ammStart}}{x_{ammEnd}}"},{"_type":"richTextBlock","_key":"99aa79b4c781","content":[{"markDefs":[],"children":[{"_type":"span","marks":[],"text":"The pool selling X gets all of the Y that didn't end up in the embedded AMM — in other words,","_key":"d35c568627dd0"}],"_type":"block","style":"normal","_key":"1f24ca1bc67d","asset":null}]},{"_type":"mathBlock","_key":"fced5d81a45e","content":"y_{out} = y_{ammStart} + y_{in} - y_{ammEnd}"},{"_type":"richTextBlock","_key":"5812bbb420b5","content":[{"_key":"1b7df4230a9a","asset":null,"markDefs":[],"children":[{"_key":"e059ce427ba90","_type":"span","marks":[],"text":"and similarly,"}],"_type":"block","style":"normal"}]},{"_type":"mathBlock","_key":"a1e6872135ff","content":"x_{out} = x_{ammStart} + x_{in} - x_{ammEnd}"},{"_type":"richTextBlock","_key":"659720c83a20","content":[{"asset":null,"_key":"96cbae52ba61","markDefs":[],"children":[{"_type":"span","marks":[],"text":"Potential Attack Vectors","_key":"94f1efd892130"}],"_type":"block","style":"h2"}]},{"_type":"richTextBlock","_key":"46d7452252f7","content":[{"_key":"07bfda9e3852","markDefs":[],"children":[{"_type":"span","marks":[],"text":"Sandwich Attacks","_key":"c97f9d9e3f920"}],"_type":"block","asset":null,"style":"h4"}]},{"_type":"richTextBlock","_key":"3bb9be0e7173","content":[{"markDefs":[],"children":[{"_type":"span","marks":[],"text":"Description","_key":"51b4716229830"}],"_type":"block","style":"h4","_key":"7606f8d155e5","asset":null},{"children":[{"_type":"span","marks":[],"text":"In a ","_key":"b1dee91f179c0"},{"_type":"span","marks":["8dcf01710178"],"text":"sandwich attack","_key":"b1dee91f179c1"},{"_type":"span","marks":[],"text":", an attacker, Atticus, sees that a trader, Trey, is about to do a trade on an AMM. Atticus sends two orders that ","_key":"b1dee91f179c2"},{"_type":"span","marks":["em"],"text":"sandwich","_key":"b1dee91f179c3"},{"_type":"span","marks":[],"text":" Trey's, thereby extracting a profit from it.","_key":"b1dee91f179c4"}],"_type":"block","style":"normal","asset":null,"_key":"f95d31bf48d3","markDefs":[{"href":"https://research.paradigm.xyz/MEV","_key":"8dcf01710178","_type":"link"}]},{"style":"normal","_key":"76f17dac117a","asset":null,"markDefs":[],"children":[{"_type":"span","marks":[],"text":"Imagine Trey sends an order to buy ETH with USDC to an AMM. Seeing this, Atticus places an order to buy ETH on the AMM before Trey does, driving the price up. Because he is paying fees to the AMM and incurring price impact, Atticus is losing money on this order.","_key":"0856690a54ea0"}],"_type":"block"},{"children":[{"_type":"span","marks":[],"text":"When Trey's order is filled, he buys the ETH at a higher price than he would have otherwise had to, because Atticus has pushed prices up. Trey's order drives the price up even higher.","_key":"d046718c3e7f0"}],"asset":null,"_type":"block","style":"normal","_key":"f480f4a69e15","markDefs":[]},{"_key":"7b82562f8c57","markDefs":[],"children":[{"_type":"span","marks":[],"text":"Now, Atticus sells his ETH back to the AMM. Because Trey has pushed prices on the AMM up since Trey bought, he sells for more than he bought and is able to realize a profit.","_key":"7af9c495b0a40"}],"_type":"block","style":"normal","asset":null},{"asset":null,"_key":"8f785c33d740","markDefs":[{"_type":"link","href":"https://medium.com/flashbots/frontrunning-the-mev-crisis-40629a613752","_key":"42514dcb3d02"}],"children":[{"_type":"span","marks":[],"text":"This attack only makes sense for Atticus if he is able to guarantee that he will be able to sell his ETH back to the AMM immediately after Trey buys. Within a given block, this is possible if Atticus is a miner, makes a deal with one, or uses a service like ","_key":"f024ed81b03d0"},{"_type":"span","marks":["42514dcb3d02"],"text":"Flashbots","_key":"f024ed81b03d1"},{"_type":"span","marks":[],"text":".","_key":"f024ed81b03d2"}],"_type":"block","style":"normal"}]},{"_type":"richTextBlock","_key":"a814a8d03fe0","content":[{"style":"h4","_key":"5d968a801c92","markDefs":[],"asset":null,"children":[{"text":"Sandwiching and Virtual Orders","_key":"d3a0c446443b0","_type":"span","marks":[]}],"_type":"block"},{"children":[{"_type":"span","marks":[],"text":"At first glance, virtual orders may seem especially vulnerable to sandwich attacks because everybody knows they are coming.","_key":"272d67b207660"}],"_type":"block","style":"normal","asset":null,"_key":"b7a121e2ba23","markDefs":[]},{"_type":"block","style":"normal","_key":"17439c239a34","markDefs":[],"children":[{"_type":"span","marks":[],"text":"However, they are saved by the fact that they execute between **blocks. An attacker wishing to sandwich the TWAMM's virtual orders would have to trade against the embedded AMM at the end of one block, causing the virtual orders to execute at a bad price between blocks, and then trade in the other direction to close the trade at the beginning of the ","_key":"d3fbde0ee5000"},{"_type":"span","marks":["em"],"text":"next","_key":"d3fbde0ee5001"},{"_type":"span","marks":[],"text":" block.","_key":"d3fbde0ee5002"}],"asset":null},{"markDefs":[],"children":[{"_type":"span","marks":[],"text":"At present, there is no way for an attacker to guarantee that they will only trade at the end of a given block if they also get to trade at the beginning of the next block. When such ","_key":"6cb1378235c20"},{"_key":"6cb1378235c21","_type":"span","marks":["em"],"text":"multi-block MEV"},{"_key":"6cb1378235c22","_type":"span","marks":[],"text":" becomes more common, allowing traders to sandwich across multiple blocks, this may become more of an issue."}],"_type":"block","style":"normal","_key":"2c0ec07a4f79","asset":null}]},{"_type":"richTextBlock","_key":"ab9495f61540","content":[{"style":"h3","_key":"ecd6b3ba7bdc","asset":null,"markDefs":[],"children":[{"_type":"span","marks":[],"text":"Information Leakage","_key":"dfacbb3fd9230"}],"_type":"block"},{"children":[{"_type":"span","marks":[],"text":"The biggest tradeoff long-term traders are likely to encounter with the TWAMM is the ","_key":"ca2d1862cb760"},{"_key":"ca2d1862cb761","_type":"span","marks":["em"],"text":"information leakage"},{"_key":"ca2d1862cb762","_type":"span","marks":[],"text":" they are exposed to when placing publicly visible orders, which are necessary due to the nature of Ethereum."}],"asset":null,"_type":"block","style":"normal","_key":"76fd1feb17c3","markDefs":[]},{"style":"normal","_key":"a4b404fafc79","asset":null,"markDefs":[],"children":[{"_type":"span","marks":[],"text":"If a trader places a sufficiently large long-term order, other traders may be tempted to ","_key":"e7b3e12ec8f30"},{"marks":["em"],"text":"front-run","_key":"e7b3e12ec8f31","_type":"span"},{"_type":"span","marks":[],"text":" it, buying up the asset on the TWAMM's embedded AMM and elsewhere in order to sell it back to the trader later as the long-term order pushes prices up.","_key":"e7b3e12ec8f32"}],"_type":"block"},{"children":[{"_type":"span","marks":[],"text":"Because users can cancel their long-term orders at any time, we expect overly aggressive front-runners to be exploited by other traders, keeping the overall impact of information leakage in check.","_key":"83ddf56c479d0"}],"_type":"block","style":"normal","_key":"05dfaff2fad6","markDefs":[],"asset":null}]},{"_type":"richTextBlock","_key":"ca33344ca33c","content":[{"markDefs":[],"children":[{"_type":"span","marks":[],"text":"Example","_key":"42f4bce288e30"}],"_type":"block","style":"h4","_key":"7e0a6183220b","asset":null},{"children":[{"_type":"span","marks":[],"text":"Imagine Sally the spoofer has noticed aggressive front-running on the TWAMM. She buys one million USDC of ETH from a liquidity aggregator, pushing up prices across the market. Then she places a massive long-term order on the TWAMM to buy one hundred thousand USDC of ETH per block for the next 24 hours.","_key":"cc65beb4a3830"}],"_type":"block","asset":null,"style":"normal","_key":"9c0910c736ac","markDefs":[]},{"markDefs":[],"children":[{"_type":"span","marks":[],"text":"Immediately, Frank the front-runner sees this order and buys one million USDC of ETH through the aggregator, pushing up prices even further. Sally sells back her ETH through the aggregator for a profit, pushing prices back down and leaving Frank with a loss. Finally, she cancels her long-term order before any of it is filled.","_key":"1fd32b545cc50"}],"_type":"block","style":"normal","_key":"a54531fe4a93","asset":null}]},{"_type":"richTextBlock","_key":"cdabe76bfbe2","content":[{"children":[{"_type":"span","marks":[],"text":"Python Reference Implementation","_key":"485d17b04ed30"}],"_type":"block","style":"h2","_key":"e9a4b8c5ef35","asset":null,"markDefs":[]},{"children":[{"_type":"span","marks":[],"text":"You can see a Python reference implementation of the TWAMM ","_key":"657bd0e4d09f0"},{"_type":"span","marks":["28768bea4869"],"text":"here","_key":"657bd0e4d09f1"},{"_key":"657bd0e4d09f2","_type":"span","marks":[],"text":"."}],"_type":"block","style":"normal","_key":"e1f4cf0eb6a6","markDefs":[{"_type":"link","href":"https://github.com/para-dave/twamm","_key":"28768bea4869"}],"asset":null},{"markDefs":[{"_type":"link","href":"https://github.com/para-dave/twamm/blob/master/twamm_demo.ipynb","_key":"b7c6add98e6c"}],"children":[{"marks":["b7c6add98e6c"],"text":"This Jupyter notebook","_key":"925e9f4c055f0","_type":"span"},{"_type":"span","marks":[],"text":" demonstrates the behavior of the TWAMM with multiple offsetting long-term orders and arbitrageurs.","_key":"925e9f4c055f1"}],"_type":"block","style":"normal","asset":null,"_key":"a15c62756328"},{"_type":"block","style":"normal","_key":"68d2f4d89901","asset":null,"markDefs":[],"children":[{"_type":"span","marks":[],"text":"For the sake of simplicity, this Python version does not implement gas optimizations like pooled orders or true lazy evaluation.","_key":"01b8a9c0221f0"}]}]},{"_type":"richTextBlock","_key":"12ac44304559","content":[{"_type":"block","style":"h2","_key":"d270dc215f3a","markDefs":[],"children":[{"_key":"d3fe332e00bd0","_type":"span","marks":[],"text":"Conclusion"}],"asset":null},{"_key":"d4fa5694f3fe","asset":null,"markDefs":[],"children":[{"_type":"span","marks":[],"text":"We've sketched out the design of the TWAMM, but our work is just beginning.","_key":"50a0f3917e080"}],"_type":"block","style":"normal"},{"style":"normal","_key":"f2e6b2d08817","asset":null,"markDefs":[{"_key":"1763a482aa6c","_type":"link","href":"mailto:dave@paradigm.xyz"},{"_type":"link","href":"https://twitter.com/messages/compose?recipient_id=1184231093576392704","_key":"662144abe16f"},{"href":"mailto:ideas@uniswap.org","_key":"2c26ba93a96e","_type":"link"}],"children":[{"marks":[],"text":"If you are interested in working on this or similar problems, you can email ","_key":"ff8e2eed0d080","_type":"span"},{"_key":"ff8e2eed0d081","_type":"span","marks":["1763a482aa6c"],"text":"dave@paradigm.xyz"},{"_type":"span","marks":[],"text":" or ","_key":"ff8e2eed0d082"},{"_type":"span","marks":["662144abe16f"],"text":"DM me on Twitter","_key":"ff8e2eed0d083"},{"marks":[],"text":", or reach out to Uniswap Labs at ","_key":"ff8e2eed0d084","_type":"span"},{"_type":"span","marks":["2c26ba93a96e"],"text":"ideas@uniswap.org","_key":"ff8e2eed0d085"},{"marks":[],"text":".","_key":"ff8e2eed0d086","_type":"span"}],"_type":"block"}]},{"_type":"richTextBlock","_key":"9ea29985c0fc","content":[{"children":[{"text":"Acknowledgments: ","_key":"8a51a7797f240","_type":"span","marks":["em"]},{"_type":"span","marks":["a8644358c3c8","em"],"text":"Sam Sun","_key":"8a51a7797f241"},{"_type":"span","marks":["em"],"text":", ","_key":"8a51a7797f242"},{"_type":"span","marks":["f0c8f4551c8d","em"],"text":"Georgios Konstantopoulos","_key":"8a51a7797f243"},{"_type":"span","marks":["em"],"text":", ","_key":"8a51a7797f244"},{"_type":"span","marks":["227a6579cb74","em"],"text":"Michael Bently","_key":"8a51a7797f245"},{"_type":"span","marks":["em"],"text":", ","_key":"8a51a7797f246"},{"marks":["1b2d91f12a6b","em"],"text":"Michael Kustermann,","_key":"8a51a7797f247","_type":"span"},{"_type":"span","marks":["em"],"text":" ","_key":"8a51a7797f248"},{"_type":"span","marks":["be5208befb9a","em"],"text":"Kevin Pang","_key":"8a51a7797f249"},{"_type":"span","marks":["em"],"text":", ","_key":"8a51a7797f2410"},{"_type":"span","marks":["2083ea66b02c","em"],"text":"Hasu","_key":"8a51a7797f2411"},{"_key":"8a51a7797f2412","_type":"span","marks":["em"],"text":", "},{"_type":"span","marks":["7effd276eb7c","em"],"text":"Sam Bankman-Fried","_key":"8a51a7797f2413"},{"_type":"span","marks":["em"],"text":", ","_key":"8a51a7797f2414"},{"_type":"span","marks":["28fa1026f84e","em"],"text":"Henry Prior","_key":"8a51a7797f2415"},{"marks":["em"],"text":", ","_key":"8a51a7797f2416","_type":"span"},{"_type":"span","marks":["7295fbabeff6","em"],"text":"Tom Cadwell","_key":"8a51a7797f2417"},{"marks":["em"],"text":", ","_key":"8a51a7797f2418","_type":"span"},{"_type":"span","marks":["f72c82b9d692","em"],"text":"Alex Wice","_key":"8a51a7797f2419"},{"_type":"span","marks":["em"],"text":", ","_key":"8a51a7797f2420"},{"_key":"8a51a7797f2421","_type":"span","marks":["970138f211e7","em"],"text":"Mewny"},{"_type":"span","marks":["em"],"text":", ","_key":"8a51a7797f2422"},{"text":"Big Magic","_key":"8a51a7797f2423","_type":"span","marks":["3bed7e759cd3","em"]},{"text":", ","_key":"8a51a7797f2424","_type":"span","marks":["em"]},{"_type":"span","marks":["8cff6a2d755f","em"],"text":"Lily Francus","_key":"8a51a7797f2425"},{"_type":"span","marks":["em"],"text":", Tarun Chitra, ","_key":"8a51a7797f2426"},{"_type":"span","marks":["1145e4a9bc77","em"],"text":"Moody Salem","_key":"8a51a7797f2427"},{"_type":"span","marks":["em"],"text":", ","_key":"8a51a7797f2428"},{"marks":["b188a37090e7","em"],"text":"Noah Zinsmeister","_key":"8a51a7797f2429","_type":"span"},{"marks":["em"],"text":", ","_key":"8a51a7797f2430","_type":"span"},{"text":"Teo Leibowitz","_key":"8a51a7797f2431","_type":"span","marks":["439e912f1b5e","em"]}],"_type":"block","style":"normal","asset":null,"_key":"1ee5701f5e00","markDefs":[{"_type":"link","href":"https://twitter.com/samczsun","_key":"a8644358c3c8"},{"_type":"link","href":"https://twitter.com/gakonst","_key":"f0c8f4551c8d"},{"_type":"link","href":"https://twitter.com/euler_mab","_key":"227a6579cb74"},{"_type":"link","href":"https://twitter.com/MMKustermann","_key":"1b2d91f12a6b"},{"_key":"be5208befb9a","_type":"link","href":"https://twitter.com/kevinxpang"},{"href":"https://twitter.com/hasufl","_key":"2083ea66b02c","_type":"link"},{"href":"https://twitter.com/SBF_Alameda","_key":"7effd276eb7c","_type":"link"},{"_type":"link","href":"https://twitter.com/priorupdates","_key":"28fa1026f84e"},{"href":"https://www.linkedin.com/in/tom-cadwell-404b49","_key":"7295fbabeff6","_type":"link"},{"_type":"link","href":"https://twitter.com/AWice","_key":"f72c82b9d692"},{"_type":"link","href":"https://twitter.com/mewn21","_key":"970138f211e7"},{"_type":"link","href":"https://twitter.com/bigmagicdao","_key":"3bed7e759cd3"},{"_type":"link","href":"https://twitter.com/nope_its_lily","_key":"8cff6a2d755f"},{"_type":"link","href":"https://twitter.com/sendmoodz?lang=en","_key":"1145e4a9bc77"},{"_type":"link","href":"https://twitter.com/NoahZinsmeister","_key":"b188a37090e7"},{"_type":"link","href":"https://twitter.com/teo_leibowitz?lang=en","_key":"439e912f1b5e"}]}]}],"_type":"post","title":"TWAMM","slug":"twamm","authors":[{"_key":"f95a1b787135","_id":"878b7c8c-7d14-4181-a1ad-91bf46a5045f","tags":[{"_id":"5f451f5f-7e63-41bf-94e2-e9086936db67","slug":"investing-and-research","title":"Investing \u0026 Research","subTags":null}],"slug":"dave-white","portrait":{"url":"https://cdn.sanity.io/images/dgybcd83/production/181aff8a7accc16c350138c6f69634a0f7ecf622-6581x4553.jpg","_type":"imageAlt","_key":null,"alt":null,"lqip":"data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAOABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMFBAf/xAAiEAACAQQCAQUAAAAAAAAAAAABAgADBAURBhITFCExQVH/xAAXAQADAQAAAAAAAAAAAAAAAAAAAQIE/8QAFxEBAQEBAAAAAAAAAAAAAAAAAAERMf/aAAwDAQACEQMRAD8A6Zi8cnj0o2xHtF8Yxd36a8bIUmQeUhNt22P2M41fmsXBX4pkyhjcgptrkIjDS719QvWjaj3eMpiu2oTPd5NjXY9YSzf/2Q==","dimensions":{"aspectRatio":1.4454206018010103,"height":4553,"_type":"sanity.imageDimensions","width":6581}},"biography":[{"children":[{"text":"Dave White is a Research Partner at Paradigm. Previously, Dave was a quantitative trader and researcher at firms including Headlands, Two Sigma, and Cutler Group. He is three credits shy of an A.B. in Mathematics from Harvard University.","_key":"e4c548971fbf0","_type":"span","marks":[]}],"asset":null,"_type":"block","style":"normal","_key":"755adeb3b0f8","markDefs":[]}],"links":[{"openInNewWindow":true,"_type":"link","_key":"8093b183dce7","title":"LinkedIn","url":"https://www.linkedin.com/in/david-alexander-white/"},{"_key":"44de8ef53a0c","title":"Twitter","url":"https://twitter.com/_Dave__White_","openInNewWindow":true,"_type":"link"},{"_type":"link","_key":"b052f56a57ff","title":"Warpcast","url":"https://warpcast.com/davewhite","openInNewWindow":true}],"hideOnAll":null,"_type":"teamMember","name":"Dave White","title":"Research Partner"},{"_key":"51177391f419","biography":[{"style":"normal","_key":"ae9d463ac62b","markDefs":[],"children":[{"marks":[],"text":"Dan McCarthy is the Head of Talent at Paradigm, focused on helping Paradigm’s portfolio companies build world-class teams. He began his career in engineering recruiting at Google before joining Clever (YC S12) as its first recruiter and later its head of talent. Most recently, he led Lime’s executive recruiting team across operations in San Francisco and Shenzhen. Dan holds a B.A. in Political Science from Stanford University.","_key":"963fcf124fce0","_type":"span"}],"_type":"block","asset":null}],"hideOnAll":null,"slug":"dan-mccarthy","links":[{"openInNewWindow":true,"_type":"link","_key":"d4cdc17fd971","title":"LinkedIn","url":"https://www.linkedin.com/in/dmccarthy7/"},{"title":"Twitter","url":"https://x.com/dmccarthy7","openInNewWindow":true,"_type":"link","_key":"fdf0392e1acf"},{"title":"Warpcast","url":"https://warpcast.com/dmccarthy.eth","openInNewWindow":true,"_type":"link","_key":"72bb826f6cf3"}],"portrait":{"_type":"imageAlt","_key":null,"alt":null,"lqip":"data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAMFBwb/xAAjEAABBAIBBAMBAAAAAAAAAAABAAIDBBESBQYhMWETMkFR/8QAGAEAAgMAAAAAAAAAAAAAAAAAAgMAAQT/xAAdEQACAQUBAQAAAAAAAAAAAAAAAQIDERIhMTLx/9oADAMBAAIRAxEAPwDSKNIMqPeBl4aSFW9HxSW5rRknfMwjJa92dXZ/PSp+s+ftU69OvQeR8+Q/Tzhc9W5k0b1WWpO+GP6aeNj7/qGV8lY05xjFqXdGkW+PDZ3ABFM3kmTRRyOI2c0EomIoxPrC5O25Xw8jHYelBRtSWpA6fVx2DfCIlVPLZI7qxT59O9qTPbWiAPYNCIicuBPp/9k=","dimensions":{"aspectRatio":1,"height":4568,"_type":"sanity.imageDimensions","width":4568},"url":"https://cdn.sanity.io/images/dgybcd83/production/d4663a1117701cd116998df4ed773aab58a47812-4568x4568.jpg"},"name":"Dan McCarthy","title":"Head of Talent","_id":"3e103a79-f6f6-458f-88a1-d0b699d39d41","tags":[{"_id":"3a33eee2-efb0-4c98-b828-5b7fc8bc7e89","slug":"portfolio-ops","title":"Portfolio \u0026 Firm Operations","subTags":[{"_id":null,"slug":"talent","title":"Talent"},{"_id":null,"slug":"legal-and-policy","title":"Legal \u0026 Policy"},{"_id":null,"slug":"design","title":"Design"},{"_id":null,"slug":"gtm","title":"Go To Market"},{"_id":null,"slug":"marketing-and-comms","title":"Marketing \u0026 Comms"},{"_id":null,"slug":"trading","title":"Trading"},{"_id":null,"slug":"firm-operations","title":"Firm Operations"}]},{"_id":"b23991ff-26b0-4dea-9311-67e39acaa028","slug":"subtag-talent","title":"(Subtag) Talent","subTags":null},{"_id":"c4d68a9b-09e8-477c-a678-fa1ee8d48084","slug":"sort-priority-7","title":"(Sort Priority) 7","subTags":null}],"_type":"teamMember"},{"_type":"authorLink","_key":"411bb6433d15","cta":{"_key":"438948226a29","title":"Hayden Adams","openInNewWindow":null,"url":"https://twitter.com/haydenzadams","_type":"link"}}]},"__N_SSG":true},"page":"/[slug]/[postMonth]/[postSlug]","query":{"slug":"2021","postMonth":"07","postSlug":"twamm"},"buildId":"l8SbaQQM0om_yyzCyQlj0","isFallback":false,"dynamicIds":[72334,7333],"gsp":true,"scriptLoader":[{"src":"https://www.googletagmanager.com/gtag/js?id=G-1JXQV4JD0S","strategy":"afterInteractive"},{"id":"google-analytics","strategy":"afterInteractive","children":"\n      \t\t\t\twindow.dataLayer = window.dataLayer || [];       \t\t\t\tfunction gtag(){window.dataLayer.push(arguments);}       \t\t\t\tgtag('js', new Date());       \t\t\t\tgtag('config', 'G-1JXQV4JD0S');\n      \t\t\t"}]}</script></body></html>